// koffee 1.4.0

/*
00000000  000  000      00000000        00000000  0000000    000  000000000   0000000   00000000
000       000  000      000             000       000   000  000     000     000   000  000   000
000000    000  000      0000000         0000000   000   000  000     000     000   000  0000000
000       000  000      000             000       000   000  000     000     000   000  000   000
000       000  0000000  00000000        00000000  0000000    000     000      0000000   000   000
 */
var FileEditor, Menu, Syntax, TextEditor, Watcher, _, clamp, dialog, electron, empty, fs, kerror, klog, kpos, popup, post, ref, remote, setStyle, slash, srcmap, stopEvent,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty,
    indexOf = [].indexOf;

ref = require('kxk'), post = ref.post, stopEvent = ref.stopEvent, setStyle = ref.setStyle, srcmap = ref.srcmap, popup = ref.popup, slash = ref.slash, empty = ref.empty, clamp = ref.clamp, kpos = ref.kpos, fs = ref.fs, klog = ref.klog, kerror = ref.kerror, _ = ref._;

Watcher = require('../tools/watcher');

TextEditor = require('./texteditor');

Syntax = require('./syntax');

Menu = require('./menu');

electron = require('electron');

remote = electron.remote;

dialog = remote.dialog;

FileEditor = (function(superClass) {
    extend(FileEditor, superClass);

    function FileEditor(viewElem) {
        this.showContextMenu = bind(this.showContextMenu, this);
        this.onContextMenu = bind(this.onContextMenu, this);
        this.changed = bind(this.changed, this);
        FileEditor.__super__.constructor.call(this, viewElem, {
            features: ['Diffbar', 'Scrollbar', 'Numbers', 'Minimap', 'Meta', 'Autocomplete', 'Brackets', 'Strings', 'CursorLine'],
            fontSize: 19
        });
        this.currentFile = null;
        this.watch = null;
        this.view.addEventListener('contextmenu', this.onContextMenu);
        this.initPigments();
        this.initInvisibles();
        this.setText('');
    }

    FileEditor.prototype.changed = function(changeInfo) {
        FileEditor.__super__.changed.call(this, changeInfo);
        return this.updateDirty();
    };

    FileEditor.prototype.updateDirty = function() {
        var dirty;
        dirty = this["do"].hasLineChanges();
        if (this.dirty !== dirty) {
            this.dirty = dirty;
            return post.emit('dirty', this.dirty);
        }
    };

    FileEditor.prototype.clear = function() {
        var ref1, ref2;
        this.setSalterMode(false);
        this.stopWatcher();
        if ((ref1 = this.diffbar) != null) {
            ref1.clear();
        }
        if ((ref2 = this.meta) != null) {
            ref2.clear();
        }
        this.setLines(['']);
        this["do"].reset();
        return this.updateDirty();
    };

    FileEditor.prototype.revert = function() {
        return this.setCurrentFile(this.currentFile);
    };

    FileEditor.prototype.setCurrentFile = function(file) {
        this.clear();
        this.stopWatcher();
        this.currentFile = file;
        this.setupFileType();
        if ((this.currentFile != null) && slash.fileExists(this.currentFile)) {
            this.setText(slash.readText(this.currentFile));
            this.watch = new Watcher(this.currentFile);
        }
        return this.emit('file', this.currentFile);
    };

    FileEditor.prototype.restoreFromTabState = function(tabsState) {
        if (tabsState.file == null) {
            return kerror("no tabsState.file?");
        }
        return this.setCurrentFile(tabsState.file, tabsState.state);
    };

    FileEditor.prototype.stopWatcher = function() {
        var ref1;
        if ((ref1 = this.watch) != null) {
            ref1.stop();
        }
        return this.watch = null;
    };

    FileEditor.prototype.shebangFileType = function() {
        var ext, fileType;
        if (this.numLines()) {
            fileType = Syntax.shebang(this.line(0));
        }
        if (fileType === 'txt') {
            if (this.currentFile != null) {
                ext = slash.ext(this.currentFile);
                if (indexOf.call(Syntax.syntaxNames, ext) >= 0) {
                    return ext;
                }
            }
        } else if (fileType) {
            return fileType;
        }
        return FileEditor.__super__.shebangFileType.call(this);
    };

    FileEditor.prototype.save = function() {
        return slash.writeText(this.currentFile, this.text(), (function(_this) {
            return function() {
                _this["do"].reset();
                return _this.updateDirty();
            };
        })(this));
    };

    FileEditor.prototype.saveAs = function() {
        return dialog.showSaveDialog({
            title: "Save File As",
            defaultPath: slash.unslash(slash.dir(this.currentFile)),
            properties: ['openFile', 'createDirectory']
        }).then((function(_this) {
            return function(result) {
                if (!result.cancelled && result.filePath) {
                    klog("saveAs " + result.filePath, _this.text());
                    return slash.writeText(result.filePath, _this.text());
                }
            };
        })(this));
    };

    FileEditor.prototype.saveScrollCursorsAndSelections = function(opt) {
        var filePositions, s;
        if (!this.currentFile) {
            return;
        }
        s = {};
        s.main = this.state.main();
        if (this.numCursors() > 1 || this.cursorPos()[0] || this.cursorPos()[1]) {
            s.cursors = this.state.cursors();
        }
        if (this.numSelections()) {
            s.selections = this.state.selections();
        }
        if (this.numHighlights()) {
            s.highlights = this.state.highlights();
        }
        if (this.scroll.scroll) {
            s.scroll = this.scroll.scroll;
        }
        filePositions = prefs.get('filePositions', Object.create(null));
        if (!_.isPlainObject(filePositions)) {
            filePositions = Object.create(null);
        }
        filePositions[this.currentFile] = s;
        return prefs.set('filePositions', filePositions);
    };

    FileEditor.prototype.restoreScrollCursorsAndSelections = function() {
        var cursors, filePositions, ref1, ref2, ref3, ref4, ref5, s;
        if (!this.currentFile) {
            return;
        }
        filePositions = prefs.get('filePositions', {});
        if (filePositions[this.currentFile] != null) {
            s = filePositions[this.currentFile];
            cursors = (ref1 = s.cursors) != null ? ref1 : [[0, 0]];
            cursors = cursors.map((function(_this) {
                return function(c) {
                    return [c[0], clamp(0, _this.numLines() - 1, c[1])];
                };
            })(this));
            this.setCursors(cursors);
            this.setSelections((ref2 = s.selections) != null ? ref2 : []);
            this.setHighlights((ref3 = s.highlights) != null ? ref3 : []);
            this.setMain((ref4 = s.main) != null ? ref4 : 0);
            this.setState(this.state);
            this.syntax.fillDiss(this.mainCursor()[1]);
            if (s.scroll) {
                this.scroll.to(s.scroll);
            }
            this.scroll.cursorIntoView();
        } else {
            this.singleCursorAtPos([0, 0]);
            if (this.mainCursor()[1] === 0) {
                this.scroll.top = 0;
            }
            this.scroll.bot = this.scroll.top - 1;
            this.scroll.to(0);
            this.scroll.cursorIntoView();
        }
        this.updateLayers();
        if ((ref5 = this.numbers) != null) {
            ref5.updateColors();
        }
        this.minimap.onEditorScroll();
        this.emit('cursor');
        return this.emit('selection');
    };

    FileEditor.prototype.centerText = function(center, animate) {
        var br, i, j, l, layers, len, len1, newOffset, offsetX, resetTrans, t, transi, visCols;
        if (animate == null) {
            animate = 300;
        }
        this.size.centerText = center;
        this.updateLayers();
        this.size.offsetX = Math.floor(this.size.charWidth / 2 + this.size.numbersWidth);
        if (center) {
            br = this.view.getBoundingClientRect();
            visCols = parseInt(br.width / this.size.charWidth);
            newOffset = parseInt(this.size.charWidth * (visCols - 100) / 2);
            this.size.offsetX = Math.max(this.size.offsetX, newOffset);
            this.size.centerText = true;
        } else {
            this.size.centerText = false;
        }
        this.updateLinePositions(animate);
        if (animate) {
            layers = ['.selections', '.highlights', '.cursors'];
            transi = ['.selection', '.highlight', '.cursor'].concat(layers);
            resetTrans = (function(_this) {
                return function() {
                    var i, j, l, len, len1, t;
                    for (i = 0, len = layers.length; i < len; i++) {
                        l = layers[i];
                        setStyle('.editor .layers ' + l, 'transform', "translateX(0)");
                    }
                    for (j = 0, len1 = transi.length; j < len1; j++) {
                        t = transi[j];
                        setStyle('.editor .layers ' + t, 'transition', "initial");
                    }
                    return _this.updateLayers();
                };
            })(this);
            if (center) {
                offsetX = this.size.offsetX - this.size.numbersWidth - this.size.charWidth / 2;
            } else {
                offsetX = Math.floor(this.size.charWidth / 2 + this.size.numbersWidth);
                offsetX = Math.max(offsetX, (this.screenSize().width - this.screenSize().height) / 2);
                offsetX -= this.size.numbersWidth + this.size.charWidth / 2;
                offsetX *= -1;
            }
            for (i = 0, len = layers.length; i < len; i++) {
                l = layers[i];
                setStyle('.editor .layers ' + l, 'transform', "translateX(" + offsetX + "px)");
            }
            for (j = 0, len1 = transi.length; j < len1; j++) {
                t = transi[j];
                setStyle('.editor .layers ' + t, 'transition', "all " + (animate / 1000) + "s");
            }
            return setTimeout(resetTrans, animate);
        } else {
            return this.updateLayers();
        }
    };

    FileEditor.prototype.onContextMenu = function(event) {
        return stopEvent(event, this.showContextMenu(kpos(event)));
    };

    FileEditor.prototype.showContextMenu = function(absPos) {
        if (absPos == null) {
            absPos = kpos(this.view.getBoundingClientRect().left, this.view.getBoundingClientRect().top);
        }
        return popup.menu({
            items: [
                {
                    text: 'Close Editor',
                    combo: 'ctrl+w'
                }, {
                    text: ''
                }
            ].concat(Menu()),
            x: absPos.x,
            y: absPos.y
        });
    };

    FileEditor.prototype.clickAtPos = function(p, event) {
        if (event.metaKey) {
            if (kpos(event).x <= this.size.numbersWidth) {
                this.singleCursorAtPos(p);
                return;
            }
        }
        return FileEditor.__super__.clickAtPos.call(this, p, event);
    };

    return FileEditor;

})(TextEditor);

module.exports = FileEditor;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZWVkaXRvci5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUEsc0tBQUE7SUFBQTs7Ozs7QUFRQSxNQUErRixPQUFBLENBQVEsS0FBUixDQUEvRixFQUFFLGVBQUYsRUFBUSx5QkFBUixFQUFtQix1QkFBbkIsRUFBNkIsbUJBQTdCLEVBQXFDLGlCQUFyQyxFQUE0QyxpQkFBNUMsRUFBbUQsaUJBQW5ELEVBQTBELGlCQUExRCxFQUFpRSxlQUFqRSxFQUF1RSxXQUF2RSxFQUEyRSxlQUEzRSxFQUFpRixtQkFBakYsRUFBeUY7O0FBRXpGLE9BQUEsR0FBYSxPQUFBLENBQVEsa0JBQVI7O0FBQ2IsVUFBQSxHQUFhLE9BQUEsQ0FBUSxjQUFSOztBQUNiLE1BQUEsR0FBYSxPQUFBLENBQVEsVUFBUjs7QUFDYixJQUFBLEdBQWEsT0FBQSxDQUFRLFFBQVI7O0FBQ2IsUUFBQSxHQUFhLE9BQUEsQ0FBUSxVQUFSOztBQUNiLE1BQUEsR0FBYSxRQUFRLENBQUM7O0FBQ3RCLE1BQUEsR0FBYSxNQUFNLENBQUM7O0FBRWQ7OztJQUVDLG9CQUFDLFFBQUQ7Ozs7UUFFQyw0Q0FBTSxRQUFOLEVBQ0k7WUFBQSxRQUFBLEVBQVUsQ0FDTixTQURNLEVBRU4sV0FGTSxFQUdOLFNBSE0sRUFJTixTQUpNLEVBS04sTUFMTSxFQU1OLGNBTk0sRUFPTixVQVBNLEVBUU4sU0FSTSxFQVNOLFlBVE0sQ0FBVjtZQVdBLFFBQUEsRUFBVSxFQVhWO1NBREo7UUFjQSxJQUFDLENBQUEsV0FBRCxHQUFlO1FBQ2YsSUFBQyxDQUFBLEtBQUQsR0FBZTtRQUVmLElBQUMsQ0FBQSxJQUFJLENBQUMsZ0JBQU4sQ0FBdUIsYUFBdkIsRUFBcUMsSUFBQyxDQUFBLGFBQXRDO1FBRUEsSUFBQyxDQUFBLFlBQUQsQ0FBQTtRQUNBLElBQUMsQ0FBQSxjQUFELENBQUE7UUFFQSxJQUFDLENBQUEsT0FBRCxDQUFTLEVB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LENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwMDAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMDAgICAgICAgIDAwMDAwMDAwICAwMDAwMDAwICAgIDAwMCAgMDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwXG4wMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4wMDAwMDAgICAgMDAwICAwMDAgICAgICAwMDAwMDAwICAgICAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMFxuMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuMDAwICAgICAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgICAgICAgIDAwMDAwMDAwICAwMDAwMDAwICAgIDAwMCAgICAgMDAwICAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMFxuIyMjXG5cbnsgcG9zdCwgc3RvcEV2ZW50LCBzZXRTdHlsZSwgc3JjbWFwLCBwb3B1cCwgc2xhc2gsIGVtcHR5LCBjbGFtcCwga3BvcywgZnMsIGtsb2csIGtlcnJvciwgXyB9ID0gcmVxdWlyZSAna3hrJ1xuXG5XYXRjaGVyICAgID0gcmVxdWlyZSAnLi4vdG9vbHMvd2F0Y2hlcidcblRleHRFZGl0b3IgPSByZXF1aXJlICcuL3RleHRlZGl0b3InXG5TeW50YXggICAgID0gcmVxdWlyZSAnLi9zeW50YXgnXG5NZW51ICAgICAgID0gcmVxdWlyZSAnLi9tZW51J1xuZWxlY3Ryb24gICA9IHJlcXVpcmUgJ2VsZWN0cm9uJ1xucmVtb3RlICAgICA9IGVsZWN0cm9uLnJlbW90ZVxuZGlhbG9nICAgICA9IHJlbW90ZS5kaWFsb2dcblxuY2xhc3MgRmlsZUVkaXRvciBleHRlbmRzIFRleHRFZGl0b3JcblxuICAgIEA6ICh2aWV3RWxlbSkgLT5cblxuICAgICAgICBzdXBlciB2aWV3RWxlbSxcbiAgICAgICAgICAgIGZlYXR1cmVzOiBbXG4gICAgICAgICAgICAgICAgJ0RpZmZiYXInXG4gICAgICAgICAgICAgICAgJ1Njcm9sbGJhcidcbiAgICAgICAgICAgICAgICAnTnVtYmVycydcbiAgICAgICAgICAgICAgICAnTWluaW1hcCdcbiAgICAgICAgICAgICAgICAnTWV0YSdcbiAgICAgICAgICAgICAgICAnQXV0b2NvbXBsZXRlJ1xuICAgICAgICAgICAgICAgICdCcmFja2V0cydcbiAgICAgICAgICAgICAgICAnU3RyaW5ncydcbiAgICAgICAgICAgICAgICAnQ3Vyc29yTGluZSdcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBmb250U2l6ZTogMTlcblxuICAgICAgICBAY3VycmVudEZpbGUgPSBudWxsXG4gICAgICAgIEB3YXRjaCAgICAgICA9IG51bGxcblxuICAgICAgICBAdmlldy5hZGRFdmVudExpc3RlbmVyICdjb250ZXh0bWVudScgQG9uQ29udGV4dE1lbnVcblxuICAgICAgICBAaW5pdFBpZ21lbnRzKClcbiAgICAgICAgQGluaXRJbnZpc2libGVzKClcblxuICAgICAgICBAc2V0VGV4dCAnJ1xuXG4gICAgIyAgMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwMDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAgICAgIDAwMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAgMCAwMDAgIDAwMCAgMDAwMCAgMDAwMDAwMCAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMFxuICAgICMgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDBcblxuICAgIGNoYW5nZWQ6IChjaGFuZ2VJbmZvKSA9PlxuXG4gICAgICAgIHN1cGVyIGNoYW5nZUluZm9cbiAgICAgICAgQHVwZGF0ZURpcnR5KClcbiAgICAgICAgXG4gICAgdXBkYXRlRGlydHk6IC0+XG4gICAgICAgIFxuICAgICAgICBkaXJ0eSA9IEBkby5oYXNMaW5lQ2hhbmdlcygpXG4gICAgICAgIGlmIEBkaXJ0eSAhPSBkaXJ0eVxuICAgICAgICAgICAgQGRpcnR5ID0gZGlydHlcbiAgICAgICAgICAgIHBvc3QuZW1pdCAnZGlydHknIEBkaXJ0eVxuXG4gICAgIyAwMDAwMDAwMCAgMDAwICAwMDAgICAgICAwMDAwMDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwXG4gICAgIyAwMDAwMDAgICAgMDAwICAwMDAgICAgICAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwXG5cbiAgICBjbGVhcjogLT5cblxuICAgICAgICBAc2V0U2FsdGVyTW9kZSBmYWxzZVxuICAgICAgICBAc3RvcFdhdGNoZXIoKVxuICAgICAgICBAZGlmZmJhcj8uY2xlYXIoKVxuICAgICAgICBAbWV0YT8uY2xlYXIoKVxuICAgICAgICBAc2V0TGluZXMgWycnXVxuICAgICAgICBAZG8ucmVzZXQoKVxuICAgICAgICBAdXBkYXRlRGlydHkoKVxuXG4gICAgcmV2ZXJ0OiAtPiBAc2V0Q3VycmVudEZpbGUgQGN1cnJlbnRGaWxlXG4gICAgICAgIFxuICAgIHNldEN1cnJlbnRGaWxlOiAoZmlsZSkgLT5cblxuICAgICAgICBAY2xlYXIoKVxuICAgICAgICBAc3RvcFdhdGNoZXIoKVxuXG4gICAgICAgIEBjdXJyZW50RmlsZSA9IGZpbGVcblxuICAgICAgICBAc2V0dXBGaWxlVHlwZSgpXG5cbiAgICAgICAgaWYgQGN1cnJlbnRGaWxlPyBhbmQgc2xhc2guZmlsZUV4aXN0cyBAY3VycmVudEZpbGVcbiAgICAgICAgICAgIEBzZXRUZXh0IHNsYXNoLnJlYWRUZXh0IEBjdXJyZW50RmlsZVxuICAgICAgICAgICAgQHdhdGNoID0gbmV3IFdhdGNoZXIgQGN1cnJlbnRGaWxlXG5cbiAgICAgICAgIyBwb3N0LmVtaXQgJ2ZpbGUnIEBjdXJyZW50RmlsZSAjIGJyb3dzZXIgJiBzaGVsZlxuXG4gICAgICAgIEBlbWl0ICdmaWxlJyBAY3VycmVudEZpbGUgIyBkaWZmYmFyLCBwaWdtZW50cywgLi4uXG5cbiAgICAgICAgIyBwb3N0LmVtaXQgJ2RpcnR5JyBAZGlydHlcblxuICAgIHJlc3RvcmVGcm9tVGFiU3RhdGU6ICh0YWJzU3RhdGUpIC0+XG5cbiAgICAgICAgcmV0dXJuIGtlcnJvciBcIm5vIHRhYnNTdGF0ZS5maWxlP1wiIGlmIG5vdCB0YWJzU3RhdGUuZmlsZT9cbiAgICAgICAgQHNldEN1cnJlbnRGaWxlIHRhYnNTdGF0ZS5maWxlLCB0YWJzU3RhdGUuc3RhdGVcblxuICAgIHN0b3BXYXRjaGVyOiAtPlxuXG4gICAgICAgIEB3YXRjaD8uc3RvcCgpXG4gICAgICAgIEB3YXRjaCA9IG51bGxcblxuICAgICMgMDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDBcbiAgICAjICAgIDAwMCAgICAgIDAwMCAwMDAgICAwMDAgICAwMDAgIDAwMFxuICAgICMgICAgMDAwICAgICAgIDAwMDAwICAgIDAwMDAwMDAwICAgMDAwMDAwMFxuICAgICMgICAgMDAwICAgICAgICAwMDAgICAgIDAwMCAgICAgICAgMDAwXG4gICAgIyAgICAwMDAgICAgICAgIDAwMCAgICAgMDAwICAgICAgICAwMDAwMDAwMFxuXG4gICAgc2hlYmFuZ0ZpbGVUeXBlOiAtPlxuXG4gICAgICAgIGZpbGVUeXBlID0gU3ludGF4LnNoZWJhbmcgQGxpbmUoMCkgaWYgQG51bUxpbmVzKClcbiAgICAgICAgaWYgZmlsZVR5cGUgPT0gJ3R4dCdcbiAgICAgICAgICAgIGlmIEBjdXJyZW50RmlsZT9cbiAgICAgICAgICAgICAgICBleHQgPSBzbGFzaC5leHQgQGN1cnJlbnRGaWxlXG4gICAgICAgICAgICAgICAgaWYgZXh0IGluIFN5bnRheC5zeW50YXhOYW1lc1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXh0XG4gICAgICAgIGVsc2UgaWYgZmlsZVR5cGVcbiAgICAgICAgICAgIHJldHVybiBmaWxlVHlwZVxuXG4gICAgICAgIHN1cGVyKClcblxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwMDAgICAwMDAgMDAwICAgMDAwMDAwMFxuICAgICMgICAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDBcbiAgICAjIDAwMDAwMDAgICAwMDAgICAwMDAgICAgICAwICAgICAgMDAwMDAwMDBcblxuICAgIHNhdmU6IC0+XG4gICAgICAgICAgICAgICAgXG4gICAgICAgIHNsYXNoLndyaXRlVGV4dCBAY3VycmVudEZpbGUsIEB0ZXh0KCksID0+XG4gICAgICAgICAgICBAZG8ucmVzZXQoKVxuICAgICAgICAgICAgQHVwZGF0ZURpcnR5KClcbiAgICAgICAgXG4gICAgc2F2ZUFzOiAtPlxuICAgIFxuICAgICAgICBkaWFsb2cuc2hvd1NhdmVEaWFsb2coXG4gICAgICAgICAgICB0aXRsZTogXCJTYXZlIEZpbGUgQXNcIlxuICAgICAgICAgICAgZGVmYXVsdFBhdGg6IHNsYXNoLnVuc2xhc2ggc2xhc2guZGlyIEBjdXJyZW50RmlsZVxuICAgICAgICAgICAgcHJvcGVydGllczogWydvcGVuRmlsZScgJ2NyZWF0ZURpcmVjdG9yeSddKS50aGVuIChyZXN1bHQpID0+XG4gICAgICAgICAgICAgICAgaWYgbm90IHJlc3VsdC5jYW5jZWxsZWQgYW5kIHJlc3VsdC5maWxlUGF0aFxuICAgICAgICAgICAgICAgICAgICBrbG9nIFwic2F2ZUFzICN7cmVzdWx0LmZpbGVQYXRofVwiIEB0ZXh0KClcbiAgICAgICAgICAgICAgICAgICAgc2xhc2gud3JpdGVUZXh0IHJlc3VsdC5maWxlUGF0aCwgQHRleHQoKVxuICAgICAgICAgICAgICAgICAgICBcbiAgICBzYXZlU2Nyb2xsQ3Vyc29yc0FuZFNlbGVjdGlvbnM6IChvcHQpIC0+XG5cbiAgICAgICAgcmV0dXJuIGlmIG5vdCBAY3VycmVudEZpbGVcbiAgICAgICAgcyA9IHt9XG5cbiAgICAgICAgcy5tYWluICAgICAgID0gQHN0YXRlLm1haW4oKVxuICAgICAgICBzLmN1cnNvcnMgICAgPSBAc3RhdGUuY3Vyc29ycygpICAgIGlmIEBudW1DdXJzb3JzKCkgPiAxIG9yIEBjdXJzb3JQb3MoKVswXSBvciBAY3Vyc29yUG9zKClbMV1cbiAgICAgICAgcy5zZWxlY3Rpb25zID0gQHN0YXRlLnNlbGVjdGlvbnMoKSBpZiBAbnVtU2VsZWN0aW9ucygpXG4gICAgICAgIHMuaGlnaGxpZ2h0cyA9IEBzdGF0ZS5oaWdobGlnaHRzKCkgaWYgQG51bUhpZ2hsaWdodHMoKVxuXG4gICAgICAgIHMuc2Nyb2xsID0gQHNjcm9sbC5zY3JvbGwgaWYgQHNjcm9sbC5zY3JvbGxcblxuICAgICAgICBmaWxlUG9zaXRpb25zID0gcHJlZnMuZ2V0ICdmaWxlUG9zaXRpb25zJyBPYmplY3QuY3JlYXRlIG51bGxcbiAgICAgICAgaWYgbm90IF8uaXNQbGFpbk9iamVjdCBmaWxlUG9zaXRpb25zXG4gICAgICAgICAgICBmaWxlUG9zaXRpb25zID0gT2JqZWN0LmNyZWF0ZSBudWxsXG4gICAgICAgIGZpbGVQb3NpdGlvbnNbQGN1cnJlbnRGaWxlXSA9IHNcbiAgICAgICAgcHJlZnMuc2V0ICdmaWxlUG9zaXRpb25zJyBmaWxlUG9zaXRpb25zXG5cbiAgICAjIDAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAwMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwMFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMDAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgICAgICAwMDAgICAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMFxuXG4gICAgcmVzdG9yZVNjcm9sbEN1cnNvcnNBbmRTZWxlY3Rpb25zOiAtPlxuXG4gICAgICAgIHJldHVybiBpZiBub3QgQGN1cnJlbnRGaWxlXG5cbiAgICAgICAgZmlsZVBvc2l0aW9ucyA9IHByZWZzLmdldCAnZmlsZVBvc2l0aW9ucycge31cblxuICAgICAgICBpZiBmaWxlUG9zaXRpb25zW0BjdXJyZW50RmlsZV0/XG5cbiAgICAgICAgICAgIHMgPSBmaWxlUG9zaXRpb25zW0BjdXJyZW50RmlsZV1cblxuICAgICAgICAgICAgY3Vyc29ycyA9IHMuY3Vyc29ycyA/IFtbMCwwXV1cbiAgICAgICAgICAgIGN1cnNvcnMgPSBjdXJzb3JzLm1hcCAoYykgPT4gW2NbMF0sIGNsYW1wKDAsQG51bUxpbmVzKCktMSxjWzFdKV1cblxuICAgICAgICAgICAgQHNldEN1cnNvcnMgICAgY3Vyc29yc1xuICAgICAgICAgICAgQHNldFNlbGVjdGlvbnMgcy5zZWxlY3Rpb25zID8gW11cbiAgICAgICAgICAgIEBzZXRIaWdobGlnaHRzIHMuaGlnaGxpZ2h0cyA/IFtdXG4gICAgICAgICAgICBAc2V0TWFpbiAgICAgICBzLm1haW4gPyAwXG4gICAgICAgICAgICBAc2V0U3RhdGUgQHN0YXRlXG5cbiAgICAgICAgICAgIEBzeW50YXguZmlsbERpc3MgQG1haW5DdXJzb3IoKVsxXVxuXG4gICAgICAgICAgICBAc2Nyb2xsLnRvIHMuc2Nyb2xsIGlmIHMuc2Nyb2xsXG4gICAgICAgICAgICBAc2Nyb2xsLmN1cnNvckludG9WaWV3KClcblxuICAgICAgICBlbHNlXG5cbiAgICAgICAgICAgIEBzaW5nbGVDdXJzb3JBdFBvcyBbMCwwXVxuICAgICAgICAgICAgQHNjcm9sbC50b3AgPSAwIGlmIEBtYWluQ3Vyc29yKClbMV0gPT0gMFxuICAgICAgICAgICAgQHNjcm9sbC5ib3QgPSBAc2Nyb2xsLnRvcC0xXG4gICAgICAgICAgICBAc2Nyb2xsLnRvIDBcbiAgICAgICAgICAgIEBzY3JvbGwuY3Vyc29ySW50b1ZpZXcoKVxuXG4gICAgICAgIEB1cGRhdGVMYXllcnMoKVxuICAgICAgICBAbnVtYmVycz8udXBkYXRlQ29sb3JzKClcbiAgICAgICAgQG1pbmltYXAub25FZGl0b3JTY3JvbGwoKVxuICAgICAgICBAZW1pdCAnY3Vyc29yJ1xuICAgICAgICBAZW1pdCAnc2VsZWN0aW9uJ1xuXG4gICAgIyAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwMCAgMDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAgICAgICAgMDAwMCAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAwMDAwICAgMDAwIDAgMDAwICAgICAwMDAgICAgIDAwMDAwMDAgICAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgMDAwICAgMDAwXG4gICAgIyAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgMDAwICAgMDAwXG5cbiAgICBjZW50ZXJUZXh0OiAoY2VudGVyLCBhbmltYXRlPTMwMCkgLT5cblxuICAgICAgICBAc2l6ZS5jZW50ZXJUZXh0ID0gY2VudGVyXG4gICAgICAgIEB1cGRhdGVMYXllcnMoKVxuXG4gICAgICAgIEBzaXplLm9mZnNldFggPSBNYXRoLmZsb29yIEBzaXplLmNoYXJXaWR0aC8yICsgQHNpemUubnVtYmVyc1dpZHRoXG4gICAgICAgIGlmIGNlbnRlclxuICAgICAgICAgICAgYnIgICAgICAgID0gQHZpZXcuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICAgICAgICAgIHZpc0NvbHMgICA9IHBhcnNlSW50IGJyLndpZHRoIC8gQHNpemUuY2hhcldpZHRoXG4gICAgICAgICAgICBuZXdPZmZzZXQgPSBwYXJzZUludCBAc2l6ZS5jaGFyV2lkdGggKiAodmlzQ29scyAtIDEwMCkgLyAyXG4gICAgICAgICAgICBAc2l6ZS5vZmZzZXRYID0gTWF0aC5tYXggQHNpemUub2Zmc2V0WCwgbmV3T2Zmc2V0XG4gICAgICAgICAgICBAc2l6ZS5jZW50ZXJUZXh0ID0gdHJ1ZVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAc2l6ZS5jZW50ZXJUZXh0ID0gZmFsc2VcblxuICAgICAgICBAdXBkYXRlTGluZVBvc2l0aW9ucyBhbmltYXRlXG5cbiAgICAgICAgaWYgYW5pbWF0ZVxuICAgICAgICAgICAgbGF5ZXJzID0gWycuc2VsZWN0aW9ucycgJy5oaWdobGlnaHRzJyAnLmN1cnNvcnMnXVxuICAgICAgICAgICAgdHJhbnNpID0gWycuc2VsZWN0aW9uJyAgJy5oaWdobGlnaHQnICAnLmN1cnNvcicgXS5jb25jYXQgbGF5ZXJzXG4gICAgICAgICAgICByZXNldFRyYW5zID0gPT5cbiAgICAgICAgICAgICAgICBzZXRTdHlsZSAnLmVkaXRvciAubGF5ZXJzICcrbCwgJ3RyYW5zZm9ybScgXCJ0cmFuc2xhdGVYKDApXCIgZm9yIGwgaW4gbGF5ZXJzXG4gICAgICAgICAgICAgICAgc2V0U3R5bGUgJy5lZGl0b3IgLmxheWVycyAnK3QsICd0cmFuc2l0aW9uJyBcImluaXRpYWxcIiBmb3IgdCBpbiB0cmFuc2lcbiAgICAgICAgICAgICAgICBAdXBkYXRlTGF5ZXJzKClcblxuICAgICAgICAgICAgaWYgY2VudGVyXG4gICAgICAgICAgICAgICAgb2Zmc2V0WCA9IEBzaXplLm9mZnNldFggLSBAc2l6ZS5udW1iZXJzV2lkdGggLSBAc2l6ZS5jaGFyV2lkdGgvMlxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIG9mZnNldFggPSBNYXRoLmZsb29yIEBzaXplLmNoYXJXaWR0aC8yICsgQHNpemUubnVtYmVyc1dpZHRoXG4gICAgICAgICAgICAgICAgb2Zmc2V0WCA9IE1hdGgubWF4IG9mZnNldFgsIChAc2NyZWVuU2l6ZSgpLndpZHRoIC0gQHNjcmVlblNpemUoKS5oZWlnaHQpIC8gMlxuICAgICAgICAgICAgICAgIG9mZnNldFggLT0gQHNpemUubnVtYmVyc1dpZHRoICsgQHNpemUuY2hhcldpZHRoLzJcbiAgICAgICAgICAgICAgICBvZmZzZXRYICo9IC0xXG5cbiAgICAgICAgICAgIHNldFN0eWxlICcuZWRpdG9yIC5sYXllcnMgJytsLCAndHJhbnNmb3JtJyBcInRyYW5zbGF0ZVgoI3tvZmZzZXRYfXB4KVwiIGZvciBsIGluIGxheWVyc1xuICAgICAgICAgICAgc2V0U3R5bGUgJy5lZGl0b3IgLmxheWVycyAnK3QsICd0cmFuc2l0aW9uJyBcImFsbCAje2FuaW1hdGUvMTAwMH1zXCIgZm9yIHQgaW4gdHJhbnNpXG4gICAgICAgICAgICBzZXRUaW1lb3V0IHJlc2V0VHJhbnMsIGFuaW1hdGVcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQHVwZGF0ZUxheWVycygpXG5cbiAgICAjIDAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4gICAgIyAwMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMFxuICAgICMgMDAwICAgICAgICAgMDAwMDAwMCAgIDAwMCAgICAgICAgIDAwMDAwMDAgICAwMDBcblxuICAgIG9uQ29udGV4dE1lbnU6IChldmVudCkgPT4gc3RvcEV2ZW50IGV2ZW50LCBAc2hvd0NvbnRleHRNZW51IGtwb3MgZXZlbnRcblxuICAgIHNob3dDb250ZXh0TWVudTogKGFic1BvcykgPT5cblxuICAgICAgICBpZiBub3QgYWJzUG9zP1xuICAgICAgICAgICAgYWJzUG9zID0ga3BvcyBAdmlldy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0LCBAdmlldy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3BcblxuICAgICAgICBwb3B1cC5tZW51IFxuICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgICB0ZXh0OidDbG9zZSBFZGl0b3InIGNvbWJvOidjdHJsK3cnXG4gICAgICAgICAgICAsXG4gICAgICAgICAgICAgICAgdGV4dDonJ1xuICAgICAgICAgICAgXS5jb25jYXQgTWVudSgpXG4gICAgICAgICAgICB4OiBhYnNQb3MueFxuICAgICAgICAgICAgeTogYWJzUG9zLnlcblxuICAgICMgIDAwMDAwMDAgIDAwMCAgICAgIDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgMDAwICAwMDAgICAgICAgMDAwMDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwXG4gICAgIyAgMDAwMDAwMCAgMDAwMDAwMCAgMDAwICAgMDAwMDAwMCAgMDAwICAgMDAwXG5cbiAgICBjbGlja0F0UG9zOiAocCwgZXZlbnQpIC0+XG5cbiAgICAgICAgaWYgZXZlbnQubWV0YUtleVxuICAgICAgICAgICAgaWYga3BvcyhldmVudCkueCA8PSBAc2l6ZS5udW1iZXJzV2lkdGhcbiAgICAgICAgICAgICAgICBAc2luZ2xlQ3Vyc29yQXRQb3MgcFxuICAgICAgICAgICAgICAgIHJldHVyblxuXG4gICAgICAgIHN1cGVyIHAsIGV2ZW50XG5cbm1vZHVsZS5leHBvcnRzID0gRmlsZUVkaXRvclxuIl19
//# sourceURL=../../coffee/editor/fileeditor.coffee
// koffee 1.4.0

/*
 0000000  000   000  000   000  000000000   0000000   000   000
000        000 000   0000  000     000     000   000   000 000
0000000     00000    000 0 000     000     000000000    00000
     000     000     000  0000     000     000   000   000 000
0000000      000     000   000     000     000   000  000   000
 */
var Balancer, Syntax, _, elem, klor, kstr, last, matchr, ref, style, valid,
    indexOf = [].indexOf;

ref = require('kxk'), matchr = ref.matchr, valid = ref.valid, style = ref.style, elem = ref.elem, last = ref.last, kstr = ref.kstr, _ = ref._;

Balancer = require('./balancer');

klor = require('klor');

Syntax = (function() {
    function Syntax(name, getLine, getLines) {
        this.name = name;
        this.getLine = getLine;
        this.getLines = getLines;
        this.diss = [];
        this.colors = {};
        this.balancer = new Balancer(this, this.getLine);
    }

    Syntax.prototype.newDiss = function(li) {
        var diss;
        diss = this.balancer.dissForLine(li);
        return diss;
    };

    Syntax.prototype.getDiss = function(li) {
        if (this.diss[li] == null) {
            this.diss[li] = this.newDiss(li);
        }
        return this.diss[li];
    };

    Syntax.prototype.setDiss = function(li, dss) {
        this.diss[li] = dss;
        return dss;
    };

    Syntax.prototype.fillDiss = function(bot) {
        var i, li, ref1, results;
        results = [];
        for (li = i = 0, ref1 = bot; 0 <= ref1 ? i <= ref1 : i >= ref1; li = 0 <= ref1 ? ++i : --i) {
            results.push(this.getDiss(li));
        }
        return results;
    };

    Syntax.prototype.setLines = function(lines) {
        return this.balancer.setLines(lines);
    };

    Syntax.prototype.changed = function(changeInfo) {
        var ch, change, di, i, len, li, ref1, ref2, results;
        if (valid(changeInfo.changes)) {
            this.balancer.blocks = null;
        }
        ref1 = changeInfo.changes;
        results = [];
        for (i = 0, len = ref1.length; i < len; i++) {
            change = ref1[i];
            ref2 = [change.doIndex, change.newIndex, change.change], di = ref2[0], li = ref2[1], ch = ref2[2];
            switch (ch) {
                case 'changed':
                    results.push(this.diss[di] = this.newDiss(di));
                    break;
                case 'deleted':
                    this.balancer.deleteLine(di);
                    results.push(this.diss.splice(di, 1));
                    break;
                case 'inserted':
                    this.balancer.insertLine(di);
                    results.push(this.diss.splice(di, 0, this.newDiss(di)));
                    break;
                default:
                    results.push(void 0);
            }
        }
        return results;
    };

    Syntax.prototype.setFileType = function(fileType) {
        this.name = fileType;
        return this.balancer.setFileType(fileType);
    };

    Syntax.prototype.clear = function() {
        this.diss = [];
        return this.balancer.clear();
    };

    Syntax.prototype.colorForClassnames = function(clss) {
        var color, computedStyle, div, opacity;
        if (this.colors[clss] == null) {
            div = elem({
                "class": clss
            });
            document.body.appendChild(div);
            computedStyle = window.getComputedStyle(div);
            color = computedStyle.color;
            opacity = computedStyle.opacity;
            if (opacity !== '1') {
                color = 'rgba(' + color.slice(4, color.length - 2) + ', ' + opacity + ')';
            }
            this.colors[clss] = color;
            div.remove();
        }
        return this.colors[clss];
    };

    Syntax.prototype.colorForStyle = function(styl) {
        var div;
        if (this.colors[styl] == null) {
            div = elem('div');
            div.style = styl;
            document.body.appendChild(div);
            this.colors[styl] = window.getComputedStyle(div).color;
            div.remove();
        }
        return this.colors[styl];
    };

    Syntax.prototype.schemeChanged = function() {
        return this.colors = {};
    };


    /*
     0000000  000000000   0000000   000000000  000   0000000
    000          000     000   000     000     000  000
    0000000      000     000000000     000     000  000
         000     000     000   000     000     000  000
    0000000      000     000   000     000     000   0000000
     */

    Syntax.matchrConfigs = {};

    Syntax.syntaxNames = [];

    Syntax.spanForTextAndSyntax = function(text, n) {
        var clrzd, d, di, diss, i, j, l, ref1, ref2, ref3, sp, spc, value;
        l = "";
        diss = this.dissForTextAndSyntax(text, n);
        if (diss != null ? diss.length : void 0) {
            last = 0;
            for (di = i = 0, ref1 = diss.length; 0 <= ref1 ? i < ref1 : i > ref1; di = 0 <= ref1 ? ++i : --i) {
                d = diss[di];
                style = (d.styl != null) && d.styl.length && (" style=\"" + d.styl + "\"") || '';
                spc = '';
                for (sp = j = ref2 = last, ref3 = d.start; ref2 <= ref3 ? j < ref3 : j > ref3; sp = ref2 <= ref3 ? ++j : --j) {
                    spc += '&nbsp;';
                }
                last = d.start + d.match.length;
                value = (d.value != null) && d.value.length && (" class=\"" + d.value + "\"") || '';
                clrzd = "<span" + style + value + ">" + spc + (kstr.encode(d.match)) + "</span>";
                l += clrzd;
            }
        }
        return l;
    };

    Syntax.rangesForTextAndSyntax = function(line, n) {
        return matchr.ranges(Syntax.matchrConfigs[n], line);
    };

    Syntax.dissForTextAndSyntax = function(text, n) {
        return klor.ranges(text, n);
    };

    Syntax.lineForDiss = function(dss) {
        var d, i, l, len;
        l = "";
        for (i = 0, len = dss.length; i < len; i++) {
            d = dss[i];
            l = _.padEnd(l, d.start);
            l += d.match;
        }
        return l;
    };

    Syntax.shebang = function(line) {
        var lastWord;
        if (line.startsWith("#!")) {
            lastWord = _.last(line.split(/[\s\/]/));
            switch (lastWord) {
                case 'python':
                    return 'py';
                case 'node':
                    return 'js';
                case 'bash':
                    return 'sh';
                default:
                    if (indexOf.call(this.syntaxNames, lastWord) >= 0) {
                        return lastWord;
                    }
            }
        }
        return 'txt';
    };

    Syntax.init = function() {
        return this.syntaxNames = this.syntaxNames.concat(klor.exts);
    };

    return Syntax;

})();

Syntax.init();

module.exports = Syntax;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ludGF4LmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSxzRUFBQTtJQUFBOztBQVFBLE1BQWdELE9BQUEsQ0FBUSxLQUFSLENBQWhELEVBQUUsbUJBQUYsRUFBVSxpQkFBVixFQUFpQixpQkFBakIsRUFBd0IsZUFBeEIsRUFBOEIsZUFBOUIsRUFBb0MsZUFBcEMsRUFBMEM7O0FBRTFDLFFBQUEsR0FBVyxPQUFBLENBQVEsWUFBUjs7QUFDWCxJQUFBLEdBQVcsT0FBQSxDQUFRLE1BQVI7O0FBRUw7SUFFQyxnQkFBQyxJQUFELEVBQVEsT0FBUixFQUFrQixRQUFsQjtRQUFDLElBQUMsQ0FBQSxPQUFEO1FBQU8sSUFBQyxDQUFBLFVBQUQ7UUFBVSxJQUFDLENBQUEsV0FBRDtRQUVqQixJQUFDLENBQUEsSUFBRCxHQUFZO1FBQ1osSUFBQyxDQUFBLE1BQUQsR0FBWTtRQUNaLElBQUMsQ0FBQSxRQUFELEdBQVksSUFBSSxRQUFKLENBQWEsSUFBYixFQUFnQixJQUFDLENBQUEsT0FBakI7SUFKYjs7cUJBWUgsT0FBQSxHQUFTLFNBQUMsRUFBRDtBQUVMLFlBQUE7UUFBQSxJQUFBLEdBQU8sSUFBQyxDQUFBLFFBQVEsQ0FBQyxXQUFWLENBQXNCLEVBQXRCO2VBQ1A7SUFISzs7cUJBS1QsT0FBQSxHQUFTLFNBQUMsRUFBRDtRQUVMLElBQU8scUJBQVA7WUFDSSxJQUFDLENBQUEsSUFBSyxDQUFBLEVBQUEsQ0FBTixHQUFZLElBQUMsQ0FBQSxPQUFELENBQVMsRUFBVCxFQURoQjs7ZUFHQSxJQUFDLENBQUEsSUFBSyxDQUFBLEVBQUE7SUFMRDs7cUJBT1QsT0FBQSxHQUFTLFNBQUMsRUFBRCxFQUFLLEdBQUw7UUFFTCxJQUFDLENBQUEsSUFBSyxDQUFBLEVBQUEsQ0FBTixHQUFZO2VBQ1o7SUFISzs7cUJBS1QsUUFBQSxHQUFVLFNBQUMsR0FBRDtBQUVOLFlBQUE7QUFBQTthQUFVLHFGQUFWO3lCQUNJLElBQUMsQ0FBQSxPQUFELENBQVMsRUFBVDtBQURKOztJQUZNOztxQkFXVixRQUFBLEdBQVUsU0FBQyxLQUFEO2VBRU4sSUFBQyxDQUFBLFFBQVEsQ0FBQyxRQUFWLENBQW1CLEtBQW5CO0lBRk07O3FCQVVWLE9BQUEsR0FBUyxTQUFDLFVBQUQ7QUFFTCxZQUFBO1FBQUEsSUFBRyxLQUFBLENBQU0sVUFBVSxDQUFDLE9BQWpCLENBQUg7WUFDSSxJQUFDLENBQUEsUUFBUSxDQUFDLE1BQVYsR0FBbUIsS0FEdkI7O0FBR0E7QUFBQTthQUFBLHNDQUFBOztZQUVJLE9BQWEsQ0FBQyxNQUFNLENBQUMsT0FBUixFQUFpQixNQUFNLENBQUMsUUFBeEIsRUFBa0MsTUFBTSxDQUFDLE1BQXpDLENBQWIsRUFBQyxZQUFELEVBQUksWUFBSixFQUFPO0FBRVAsb0JBQU8sRUFBUDtBQUFBLHFCQUVTLFNBRlQ7aUNBSVEsSUFBQyxDQUFBLElBQUssQ0FBQSxFQUFBLENBQU4sR0FBWSxJQUFDLENBQUEsT0FBRCxDQUFTLEVBQVQ7QUFGWDtBQUZULHFCQU1TLFNBTlQ7b0JBUVEsSUFBQyxDQUFBLFFBQVEsQ0FBQyxVQUFWLENBQXFCLEVBQXJCO2lDQUNBLElBQUMsQ0FBQSxJQUFJLENBQUMsTUFBTixDQUFhLEVBQWIsRUFBaUIsQ0FBakI7QUFIQztBQU5ULHFCQVdTLFVBWFQ7b0JBYVEsSUFBQyxDQUFBLFFBQVEsQ0FBQyxVQUFWLENBQXFCLEVBQXJCO2lDQUNBLElBQUMsQ0FBQSxJQUFJLENBQUMsTUFBTixDQUFhLEVBQWIsRUFBaUIsQ0FBakIsRUFBb0IsSUFBQyxDQUFBLE9BQUQsQ0FBUyxFQUFULENBQXBCO0FBSEM7QUFYVDs7QUFBQTtBQUpKOztJQUxLOztxQkErQlQsV0FBQSxHQUFhLFNBQUMsUUFBRDtRQUlULElBQUMsQ0FBQSxJQUFELEdBQVE7ZUFDUixJQUFDLENBQUEsUUFBUSxDQUFDLFdBQVYsQ0FBc0IsUUFBdEI7SUFMUzs7cUJBYWIsS0FBQSxHQUFPLFNBQUE7UUFFSCxJQUFDLENBQUEsSUFBRCxHQUFRO2VBQ1IsSUFBQyxDQUFBLFFBQVEsQ0FBQyxLQUFWLENBQUE7SUFIRzs7cUJBV1Asa0JBQUEsR0FBb0IsU0FBQyxJQUFEO0FBRWhCLFlBQUE7UUFBQSxJQUFPLHlCQUFQO1lBRUksR0FBQSxHQUFNLElBQUEsQ0FBSztnQkFBQSxDQUFBLEtBQUEsQ0FBQSxFQUFPLElBQVA7YUFBTDtZQUNOLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBZCxDQUEwQixHQUExQjtZQUNBLGFBQUEsR0FBZ0IsTUFBTSxDQUFDLGdCQUFQLENBQXdCLEdBQXhCO1lBQ2hCLEtBQUEsR0FBUSxhQUFhLENBQUM7WUFDdEIsT0FBQSxHQUFVLGFBQWEsQ0FBQztZQUN4QixJQUFHLE9BQUEsS0FBVyxHQUFkO2dCQUNJLEtBQUEsR0FBUSxPQUFBLEdBQVUsS0FBSyxDQUFDLEtBQU4sQ0FBWSxDQUFaLEVBQWUsS0FBSyxDQUFDLE1BQU4sR0FBYSxDQUE1QixDQUFWLEdBQTJDLElBQTNDLEdBQWtELE9BQWxELEdBQTRELElBRHhFOztZQUVBLElBQUMsQ0FBQSxNQUFPLENBQUEsSUFBQSxDQUFSLEdBQWdCO1lBQ2hCLEdBQUcsQ0FBQyxNQUFKLENBQUEsRUFWSjs7QUFZQSxlQUFPLElBQUMsQ0FBQSxNQUFPLENBQUEsSUFBQTtJQWRDOztxQkFnQnBCLGFBQUEsR0FBZSxTQUFDLElBQUQ7QUFFWCxZQUFBO1FBQUEsSUFBTyx5QkFBUDtZQUNJLEdBQUEsR0FBTSxJQUFBLENBQUssS0FBTDtZQUNOLEdBQUcsQ0FBQyxLQUFKLEdBQVk7WUFDWixRQUFRLENBQUMsSUFBSSxDQUFDLFdBQWQsQ0FBMEIsR0FBMUI7WUFDQSxJQUFDLENBQUEsTUFBTyxDQUFBLElBQUEsQ0FBUixHQUFnQixNQUFNLENBQUMsZ0JBQVAsQ0FBd0IsR0FBeEIsQ0FBNEIsQ0FBQztZQUM3QyxHQUFHLENBQUMsTUFBSixDQUFBLEVBTEo7O0FBT0EsZUFBTyxJQUFDLENBQUEsTUFBTyxDQUFBLElBQUE7SUFUSjs7cUJBV2YsYUFBQSxHQUFlLFNBQUE7ZUFBRyxJQUFDLENBQUEsTUFBRCxHQUFVO0lBQWI7OztBQUVmOzs7Ozs7OztJQVFBLE1BQUMsQ0FBQSxhQUFELEdBQWlCOztJQUNqQixNQUFDLENBQUEsV0FBRCxHQUFlOztJQUVmLE1BQUMsQ0FBQSxvQkFBRCxHQUF1QixTQUFDLElBQUQsRUFBTyxDQUFQO0FBRW5CLFlBQUE7UUFBQSxDQUFBLEdBQUk7UUFDSixJQUFBLEdBQU8sSUFBQyxDQUFBLG9CQUFELENBQXNCLElBQXRCLEVBQTRCLENBQTVCO1FBQ1AsbUJBQUcsSUFBSSxDQUFFLGVBQVQ7WUFDSSxJQUFBLEdBQU87QUFDUCxpQkFBVSwyRkFBVjtnQkFDSSxDQUFBLEdBQUksSUFBSyxDQUFBLEVBQUE7Z0JBQ1QsS0FBQSxHQUFRLGdCQUFBLElBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFuQixJQUE4QixDQUFBLFdBQUEsR0FBWSxDQUFDLENBQUMsSUFBZCxHQUFtQixJQUFuQixDQUE5QixJQUF3RDtnQkFDaEUsR0FBQSxHQUFNO0FBQ04scUJBQVUsdUdBQVY7b0JBQ0ksR0FBQSxJQUFPO0FBRFg7Z0JBRUEsSUFBQSxHQUFRLENBQUMsQ0FBQyxLQUFGLEdBQVUsQ0FBQyxDQUFDLEtBQUssQ0FBQztnQkFDMUIsS0FBQSxHQUFRLGlCQUFBLElBQWEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFyQixJQUFnQyxDQUFBLFdBQUEsR0FBWSxDQUFDLENBQUMsS0FBZCxHQUFvQixJQUFwQixDQUFoQyxJQUEyRDtnQkFDbkUsS0FBQSxHQUFRLE9BQUEsR0FBUSxLQUFSLEdBQWdCLEtBQWhCLEdBQXNCLEdBQXRCLEdBQXlCLEdBQXpCLEdBQThCLENBQUMsSUFBSSxDQUFDLE1BQUwsQ0FBWSxDQUFDLENBQUMsS0FBZCxDQUFELENBQTlCLEdBQW1EO2dCQUMzRCxDQUFBLElBQUs7QUFUVCxhQUZKOztlQVlBO0lBaEJtQjs7SUFrQnZCLE1BQUMsQ0FBQSxzQkFBRCxHQUF5QixTQUFDLElBQUQsRUFBTyxDQUFQO2VBRXJCLE1BQU0sQ0FBQyxNQUFQLENBQWMsTUFBTSxDQUFDLGFBQWMsQ0FBQSxDQUFBLENBQW5DLEVBQXVDLElBQXZDO0lBRnFCOztJQUl6QixNQUFDLENBQUEsb0JBQUQsR0FBdUIsU0FBQyxJQUFELEVBQU8sQ0FBUDtlQUVuQixJQUFJLENBQUMsTUFBTCxDQUFZLElBQVosRUFBa0IsQ0FBbEI7SUFGbUI7O0lBSXZCLE1BQUMsQ0FBQSxXQUFELEdBQWMsU0FBQyxHQUFEO0FBRVYsWUFBQTtRQUFBLENBQUEsR0FBSTtBQUNKLGFBQUEscUNBQUE7O1lBQ0ksQ0FBQSxHQUFJLENBQUMsQ0FBQyxNQUFGLENBQVMsQ0FBVCxFQUFZLENBQUMsQ0FBQyxLQUFkO1lBQ0osQ0FBQSxJQUFLLENBQUMsQ0FBQztBQUZYO2VBR0E7SUFOVTs7SUFjZCxNQUFDLENBQUEsT0FBRCxHQUFVLFNBQUMsSUFBRDtBQUVOLFlBQUE7UUFBQSxJQUFHLElBQUksQ0FBQyxVQUFMLENBQWdCLElBQWhCLENBQUg7WUFDSSxRQUFBLEdBQVcsQ0FBQyxDQUFDLElBQUYsQ0FBTyxJQUFJLENBQUMsS0FBTCxDQUFXLFFBQVgsQ0FBUDtBQUNYLG9CQUFPLFFBQVA7QUFBQSxxQkFDUyxRQURUO0FBQ3VCLDJCQUFPO0FBRDlCLHFCQUVTLE1BRlQ7QUFFdUIsMkJBQU87QUFGOUIscUJBR1MsTUFIVDtBQUd1QiwyQkFBTztBQUg5QjtvQkFLUSxJQUFHLGFBQVksSUFBQyxDQUFBLFdBQWIsRUFBQSxRQUFBLE1BQUg7QUFDSSwrQkFBTyxTQURYOztBQUxSLGFBRko7O2VBU0E7SUFYTTs7SUFtQlYsTUFBQyxDQUFBLElBQUQsR0FBTyxTQUFBO2VBeUJILElBQUMsQ0FBQSxXQUFELEdBQWUsSUFBQyxDQUFBLFdBQVcsQ0FBQyxNQUFiLENBQW9CLElBQUksQ0FBQyxJQUF6QjtJQXpCWjs7Ozs7O0FBMkJYLE1BQU0sQ0FBQyxJQUFQLENBQUE7O0FBQ0EsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbiAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMFxuMDAwICAgICAgICAwMDAgMDAwICAgMDAwMCAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgIDAwMCAwMDBcbjAwMDAwMDAgICAgIDAwMDAwICAgIDAwMCAwIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMDAgICAgMDAwMDBcbiAgICAgMDAwICAgICAwMDAgICAgIDAwMCAgMDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgICAwMDAgMDAwXG4wMDAwMDAwICAgICAgMDAwICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDBcbiMjI1xuXG57IG1hdGNociwgdmFsaWQsIHN0eWxlLCBlbGVtLCBsYXN0LCBrc3RyLCBfIH0gPSByZXF1aXJlICdreGsnXG5cbkJhbGFuY2VyID0gcmVxdWlyZSAnLi9iYWxhbmNlcidcbmtsb3IgICAgID0gcmVxdWlyZSAna2xvcidcblxuY2xhc3MgU3ludGF4XG4gICAgXG4gICAgQDogKEBuYW1lLCBAZ2V0TGluZSwgQGdldExpbmVzKSAtPlxuXG4gICAgICAgIEBkaXNzICAgICA9IFtdXG4gICAgICAgIEBjb2xvcnMgICA9IHt9XG4gICAgICAgIEBiYWxhbmNlciA9IG5ldyBCYWxhbmNlciBALCBAZ2V0TGluZVxuXG4gICAgIyAwMDAwMDAwICAgIDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgMDAwICAgICAgIDAwMFxuICAgICMgMDAwICAgMDAwICAwMDAgIDAwMDAwMDAgICAwMDAwMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwXG4gICAgIyAwMDAwMDAwICAgIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDBcblxuICAgIG5ld0Rpc3M6IChsaSkgLT5cblxuICAgICAgICBkaXNzID0gQGJhbGFuY2VyLmRpc3NGb3JMaW5lIGxpXG4gICAgICAgIGRpc3NcblxuICAgIGdldERpc3M6IChsaSkgLT5cblxuICAgICAgICBpZiBub3QgQGRpc3NbbGldP1xuICAgICAgICAgICAgQGRpc3NbbGldID0gQG5ld0Rpc3MgbGlcblxuICAgICAgICBAZGlzc1tsaV1cblxuICAgIHNldERpc3M6IChsaSwgZHNzKSAtPlxuXG4gICAgICAgIEBkaXNzW2xpXSA9IGRzc1xuICAgICAgICBkc3NcblxuICAgIGZpbGxEaXNzOiAoYm90KSAtPlxuXG4gICAgICAgIGZvciBsaSBpbiBbMC4uYm90XVxuICAgICAgICAgICAgQGdldERpc3MgbGlcblxuICAgICMgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMCAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgICAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMCAgICAgIDAwMCAgMDAwIDAgMDAwICAwMDAwMDAwICAgMDAwMDAwMCAgIFxuICAgICMgICAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgICAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAgICAgICAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAwICAgICAwMDAgICAgIDAwMDAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMCAgIFxuICAgIFxuICAgIHNldExpbmVzOiAobGluZXMpIC0+XG4gICAgICAgIFxuICAgICAgICBAYmFsYW5jZXIuc2V0TGluZXMgbGluZXNcbiAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwIDAgMDAwICAwMDAgIDAwMDAgIDAwMDAwMDAgICAwMDAgICAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDBcbiAgICAjICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAwMDAwXG5cbiAgICBjaGFuZ2VkOiAoY2hhbmdlSW5mbykgLT5cblxuICAgICAgICBpZiB2YWxpZCBjaGFuZ2VJbmZvLmNoYW5nZXNcbiAgICAgICAgICAgIEBiYWxhbmNlci5ibG9ja3MgPSBudWxsXG4gICAgICAgIFxuICAgICAgICBmb3IgY2hhbmdlIGluIGNoYW5nZUluZm8uY2hhbmdlc1xuXG4gICAgICAgICAgICBbZGksbGksY2hdID0gW2NoYW5nZS5kb0luZGV4LCBjaGFuZ2UubmV3SW5kZXgsIGNoYW5nZS5jaGFuZ2VdXG5cbiAgICAgICAgICAgIHN3aXRjaCBjaFxuXG4gICAgICAgICAgICAgICAgd2hlbiAnY2hhbmdlZCdcblxuICAgICAgICAgICAgICAgICAgICBAZGlzc1tkaV0gPSBAbmV3RGlzcyBkaVxuXG4gICAgICAgICAgICAgICAgd2hlbiAnZGVsZXRlZCdcblxuICAgICAgICAgICAgICAgICAgICBAYmFsYW5jZXIuZGVsZXRlTGluZSBkaVxuICAgICAgICAgICAgICAgICAgICBAZGlzcy5zcGxpY2UgZGksIDFcblxuICAgICAgICAgICAgICAgIHdoZW4gJ2luc2VydGVkJ1xuXG4gICAgICAgICAgICAgICAgICAgIEBiYWxhbmNlci5pbnNlcnRMaW5lIGRpXG4gICAgICAgICAgICAgICAgICAgIEBkaXNzLnNwbGljZSBkaSwgMCwgQG5ld0Rpc3MgZGlcblxuICAgICMgMDAwMDAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgICAgMDAwICAgICAgMDAwIDAwMCAgIDAwMCAgIDAwMCAgMDAwXG4gICAgIyAwMDAwMDAgICAgMDAwICAwMDAgICAgICAwMDAwMDAwICAgICAgMDAwICAgICAgIDAwMDAwICAgIDAwMDAwMDAwICAgMDAwMDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgICAgMDAwICAgICAwMDAgICAgICAgIDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgICAgIDAwMCAgICAgICAgMDAwICAgICAwMDAgICAgICAgIDAwMDAwMDAwXG5cbiAgICBzZXRGaWxlVHlwZTogKGZpbGVUeXBlKSAtPlxuXG4gICAgICAgICMga2xvZyAnU3ludGF4LnNldEZpbGVUeXBlJywgZmlsZVR5cGVcbiAgICAgICAgXG4gICAgICAgIEBuYW1lID0gZmlsZVR5cGVcbiAgICAgICAgQGJhbGFuY2VyLnNldEZpbGVUeXBlIGZpbGVUeXBlXG4gICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICMgIDAwMDAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuXG4gICAgY2xlYXI6IC0+XG5cbiAgICAgICAgQGRpc3MgPSBbXVxuICAgICAgICBAYmFsYW5jZXIuY2xlYXIoKVxuXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAgICAgMDAwMDAwMCAgIDAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgMDAwICAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDBcblxuICAgIGNvbG9yRm9yQ2xhc3NuYW1lczogKGNsc3MpIC0+XG5cbiAgICAgICAgaWYgbm90IEBjb2xvcnNbY2xzc10/XG5cbiAgICAgICAgICAgIGRpdiA9IGVsZW0gY2xhc3M6IGNsc3NcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQgZGl2XG4gICAgICAgICAgICBjb21wdXRlZFN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUgZGl2XG4gICAgICAgICAgICBjb2xvciA9IGNvbXB1dGVkU3R5bGUuY29sb3JcbiAgICAgICAgICAgIG9wYWNpdHkgPSBjb21wdXRlZFN0eWxlLm9wYWNpdHlcbiAgICAgICAgICAgIGlmIG9wYWNpdHkgIT0gJzEnXG4gICAgICAgICAgICAgICAgY29sb3IgPSAncmdiYSgnICsgY29sb3Iuc2xpY2UoNCwgY29sb3IubGVuZ3RoLTIpICsgJywgJyArIG9wYWNpdHkgKyAnKSdcbiAgICAgICAgICAgIEBjb2xvcnNbY2xzc10gPSBjb2xvclxuICAgICAgICAgICAgZGl2LnJlbW92ZSgpXG5cbiAgICAgICAgcmV0dXJuIEBjb2xvcnNbY2xzc11cblxuICAgIGNvbG9yRm9yU3R5bGU6IChzdHlsKSAtPlxuXG4gICAgICAgIGlmIG5vdCBAY29sb3JzW3N0eWxdP1xuICAgICAgICAgICAgZGl2ID0gZWxlbSAnZGl2J1xuICAgICAgICAgICAgZGl2LnN0eWxlID0gc3R5bFxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCBkaXZcbiAgICAgICAgICAgIEBjb2xvcnNbc3R5bF0gPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShkaXYpLmNvbG9yXG4gICAgICAgICAgICBkaXYucmVtb3ZlKClcblxuICAgICAgICByZXR1cm4gQGNvbG9yc1tzdHlsXVxuXG4gICAgc2NoZW1lQ2hhbmdlZDogLT4gQGNvbG9ycyA9IHt9XG5cbiAgICAjIyNcbiAgICAgMDAwMDAwMCAgMDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwICAgMDAwMDAwMFxuICAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgIDAwMFxuICAgIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMDAwMDAwMCAgICAgMDAwICAgICAwMDAgIDAwMFxuICAgICAgICAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgIDAwMFxuICAgIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAwMDAwXG4gICAgIyMjXG5cbiAgICBAbWF0Y2hyQ29uZmlncyA9IHt9XG4gICAgQHN5bnRheE5hbWVzID0gW11cblxuICAgIEBzcGFuRm9yVGV4dEFuZFN5bnRheDogKHRleHQsIG4pIC0+XG5cbiAgICAgICAgbCA9IFwiXCJcbiAgICAgICAgZGlzcyA9IEBkaXNzRm9yVGV4dEFuZFN5bnRheCB0ZXh0LCBuXG4gICAgICAgIGlmIGRpc3M/Lmxlbmd0aFxuICAgICAgICAgICAgbGFzdCA9IDBcbiAgICAgICAgICAgIGZvciBkaSBpbiBbMC4uLmRpc3MubGVuZ3RoXVxuICAgICAgICAgICAgICAgIGQgPSBkaXNzW2RpXVxuICAgICAgICAgICAgICAgIHN0eWxlID0gZC5zdHlsPyBhbmQgZC5zdHlsLmxlbmd0aCBhbmQgXCIgc3R5bGU9XFxcIiN7ZC5zdHlsfVxcXCJcIiBvciAnJ1xuICAgICAgICAgICAgICAgIHNwYyA9ICcnXG4gICAgICAgICAgICAgICAgZm9yIHNwIGluIFtsYXN0Li4uZC5zdGFydF1cbiAgICAgICAgICAgICAgICAgICAgc3BjICs9ICcmbmJzcDsnXG4gICAgICAgICAgICAgICAgbGFzdCAgPSBkLnN0YXJ0ICsgZC5tYXRjaC5sZW5ndGhcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IGQudmFsdWU/IGFuZCBkLnZhbHVlLmxlbmd0aCBhbmQgXCIgY2xhc3M9XFxcIiN7ZC52YWx1ZX1cXFwiXCIgb3IgJydcbiAgICAgICAgICAgICAgICBjbHJ6ZCA9IFwiPHNwYW4je3N0eWxlfSN7dmFsdWV9PiN7c3BjfSN7a3N0ci5lbmNvZGUgZC5tYXRjaH08L3NwYW4+XCJcbiAgICAgICAgICAgICAgICBsICs9IGNscnpkXG4gICAgICAgIGxcblxuICAgIEByYW5nZXNGb3JUZXh0QW5kU3ludGF4OiAobGluZSwgbikgLT5cblxuICAgICAgICBtYXRjaHIucmFuZ2VzIFN5bnRheC5tYXRjaHJDb25maWdzW25dLCBsaW5lXG5cbiAgICBAZGlzc0ZvclRleHRBbmRTeW50YXg6ICh0ZXh0LCBuKSAtPlxuXG4gICAgICAgIGtsb3IucmFuZ2VzIHRleHQsIG5cblxuICAgIEBsaW5lRm9yRGlzczogKGRzcykgLT5cblxuICAgICAgICBsID0gXCJcIlxuICAgICAgICBmb3IgZCBpbiBkc3NcbiAgICAgICAgICAgIGwgPSBfLnBhZEVuZCBsLCBkLnN0YXJ0XG4gICAgICAgICAgICBsICs9IGQubWF0Y2hcbiAgICAgICAgbFxuXG4gICAgIyAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMCAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAwMDBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAwMCAgMDAwIDAgMDAwICAwMDAgIDAwMDBcbiAgICAjICAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAwMDBcbiAgICAjIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMFxuXG4gICAgQHNoZWJhbmc6IChsaW5lKSAtPlxuXG4gICAgICAgIGlmIGxpbmUuc3RhcnRzV2l0aCBcIiMhXCJcbiAgICAgICAgICAgIGxhc3RXb3JkID0gXy5sYXN0IGxpbmUuc3BsaXQgL1tcXHNcXC9dL1xuICAgICAgICAgICAgc3dpdGNoIGxhc3RXb3JkXG4gICAgICAgICAgICAgICAgd2hlbiAncHl0aG9uJyB0aGVuIHJldHVybiAncHknXG4gICAgICAgICAgICAgICAgd2hlbiAnbm9kZScgICB0aGVuIHJldHVybiAnanMnXG4gICAgICAgICAgICAgICAgd2hlbiAnYmFzaCcgICB0aGVuIHJldHVybiAnc2gnXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBpZiBsYXN0V29yZCBpbiBAc3ludGF4TmFtZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsYXN0V29yZFxuICAgICAgICAndHh0J1xuXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwMDAwMDBcbiAgICAjIDAwMCAgMDAwMCAgMDAwICAwMDAgICAgIDAwMFxuICAgICMgMDAwICAwMDAgMCAwMDAgIDAwMCAgICAgMDAwXG4gICAgIyAwMDAgIDAwMCAgMDAwMCAgMDAwICAgICAwMDBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAwMDAgICAgIDAwMFxuXG4gICAgQGluaXQ6IC0+XG5cbiAgICAgICAgIyBzeW50YXhEaXIgPSBcIiN7X19kaXJuYW1lfS8uLi8uLi9zeW50YXgvXCJcblxuICAgICAgICAjIGZvciBzeW50YXhGaWxlIGluIGZzLnJlYWRkaXJTeW5jIHN5bnRheERpclxuXG4gICAgICAgICAgICAjIHN5bnRheE5hbWUgPSBzbGFzaC5iYXNlbmFtZSBzeW50YXhGaWxlLCAnLm5vb24nXG4gICAgICAgICAgICAjIHBhdHRlcm5zID0gbm9vbi5sb2FkIHNsYXNoLmpvaW4gc3ludGF4RGlyLCBzeW50YXhGaWxlXG5cbiAgICAgICAgICAgICMgcGF0dGVybnNbJ1xcXFx3KyddICAgICAgID0gJ3RleHQnICAgIyB0aGlzIGVuc3VyZXMgdGhhdCBhbGwgLi4uXG4gICAgICAgICAgICAjIHBhdHRlcm5zWydbXlxcXFx3XFxcXHNdKyddID0gJ3N5bnRheCcgIyBub24tc3BhY2UgY2hhcmFjdGVycyBtYXRjaFxuXG4gICAgICAgICAgICAjIGlmIHBhdHRlcm5zLmtvPy5leHRuYW1lcz9cbiAgICAgICAgICAgICAgICAjIGV4dG5hbWVzID0gcGF0dGVybnMua28uZXh0bmFtZXNcbiAgICAgICAgICAgICAgICAjIGRlbGV0ZSBwYXR0ZXJucy5rb1xuXG4gICAgICAgICAgICAgICAgIyBjb25maWcgPSBtYXRjaHIuY29uZmlnIHBhdHRlcm5zXG4gICAgICAgICAgICAgICAgIyBmb3Igc3ludGF4TmFtZSBpbiBleHRuYW1lc1xuICAgICAgICAgICAgICAgICAgICAjIEBzeW50YXhOYW1lcy5wdXNoIHN5bnRheE5hbWVcbiAgICAgICAgICAgICAgICAgICAgIyBAbWF0Y2hyQ29uZmlnc1tzeW50YXhOYW1lXSA9IGNvbmZpZ1xuICAgICAgICAgICAgIyBlbHNlXG4gICAgICAgICAgICAgICAgIyBAc3ludGF4TmFtZXMucHVzaCBzeW50YXhOYW1lXG4gICAgICAgICAgICAgICAgIyBAbWF0Y2hyQ29uZmlnc1tzeW50YXhOYW1lXSA9IG1hdGNoci5jb25maWcgcGF0dGVybnNcblxuICAgICAgICAjIGtsb3IuaW5pdCgpXG4gICAgICAgIEBzeW50YXhOYW1lcyA9IEBzeW50YXhOYW1lcy5jb25jYXQga2xvci5leHRzXG5cblN5bnRheC5pbml0KClcbm1vZHVsZS5leHBvcnRzID0gU3ludGF4XG4iXX0=
//# sourceURL=../../coffee/editor/syntax.coffee
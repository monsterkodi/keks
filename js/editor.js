// koffee 1.4.0

/*
00000000  0000000    000  000000000   0000000   00000000   
000       000   000  000     000     000   000  000   000  
0000000   000   000  000     000     000   000  0000000    
000       000   000  000     000     000   000  000   000  
00000000  0000000    000     000      0000000   000   000
 */
var $, BaseEditor, Editor, File, FileEditor, _, elem, empty, keyinfo, klog, open, post, ref, slash, stopEvent,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), slash = ref.slash, empty = ref.empty, post = ref.post, open = ref.open, elem = ref.elem, stopEvent = ref.stopEvent, keyinfo = ref.keyinfo, klog = ref.klog, $ = ref.$, _ = ref._;

File = require('./tools/file');

BaseEditor = require('./editor/editor');

FileEditor = require('./editor/fileeditor');

Editor = (function() {
    function Editor(path) {
        this.onMenuAction = bind(this.onMenuAction, this);
        this.close = bind(this.close, this);
        this.onKey = bind(this.onKey, this);
        var main;
        this.div = elem({
            "class": 'editor',
            tabindex: 1
        });
        this.focus = document.activeElement;
        main = $('#main');
        main.appendChild(this.div);
        this.editor = new FileEditor(this.div);
        post.on('menuAction', this.onMenuAction);
        this.div.addEventListener('keydown', this.onKey);
        this.div.focus();
        this.editor.setCurrentFile(path);
    }

    Editor.prototype.onKey = function(event) {
        var c, char, combo, key, mod, ref1;
        ref1 = keyinfo.forEvent(event), mod = ref1.mod, key = ref1.key, combo = ref1.combo, char = ref1.char;
        switch (combo) {
            case 'ctrl+w':
                return stopEvent(event, this.close());
            case 'esc':
                if (!this.editor.dirty) {
                    return stopEvent(event, this.close());
                }
                break;
            case 'space':
                c = this.editor.mainCursor();
                if (c[0] === 1 && c[1] === 0) {
                    return stopEvent(event, this.close());
                }
        }
        return klog('onKey', mod, key, combo);
    };

    Editor.prototype.close = function() {
        this.div.remove();
        this.focus.focus();
        this.editor.del();
        return delete this.editor;
    };

    Editor.prototype.resized = function() {
        var ref1;
        return (ref1 = this.editor) != null ? ref1.resized() : void 0;
    };

    Editor.prototype.onMenuAction = function(name, args) {
        var action;
        if (!this.editor) {
            return;
        }
        klog("editor menu action! '" + name + "' args:", args);
        if (action = BaseEditor.actionWithName(name)) {
            if ((action.key != null) && _.isFunction(this.editor[action.key])) {
                this.editor[action.key](args.actarg);
                return;
            }
        }
        switch (name) {
            case 'Close Editor':
                return this.close();
            case 'Undo':
                return this.editor["do"].undo();
            case 'Redo':
                return this.editor["do"].redo();
            case 'Cut':
                return this.editor.cut();
            case 'Copy':
                return this.editor.copy();
            case 'Paste':
                return this.editor.paste();
            case 'Toggle Center Text':
                return toggleCenterText();
            case 'Increase':
                return changeFontSize(+1);
            case 'Decrease':
                return changeFontSize(-1);
            case 'Reset':
                return resetFontSize();
            case 'Save':
                return post.emit('saveFile');
            case 'Save As ...':
                return post.emit('saveFileAs');
            case 'Revert':
                return post.emit('reloadFile');
        }
        klog("unhandled menu action! '" + name + "' args:", args);
        return 'unhandled';
    };

    return Editor;

})();

module.exports = Editor;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdG9yLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSx5R0FBQTtJQUFBOztBQVFBLE1BQXFFLE9BQUEsQ0FBUSxLQUFSLENBQXJFLEVBQUUsaUJBQUYsRUFBUyxpQkFBVCxFQUFnQixlQUFoQixFQUFzQixlQUF0QixFQUE0QixlQUE1QixFQUFrQyx5QkFBbEMsRUFBNkMscUJBQTdDLEVBQXNELGVBQXRELEVBQTRELFNBQTVELEVBQStEOztBQUUvRCxJQUFBLEdBQWEsT0FBQSxDQUFRLGNBQVI7O0FBQ2IsVUFBQSxHQUFhLE9BQUEsQ0FBUSxpQkFBUjs7QUFDYixVQUFBLEdBQWEsT0FBQSxDQUFRLHFCQUFSOztBQUVQO0lBRUMsZ0JBQUMsSUFBRDs7OztBQUVDLFlBQUE7UUFBQSxJQUFDLENBQUEsR0FBRCxHQUFPLElBQUEsQ0FBSztZQUFBLENBQUEsS0FBQSxDQUFBLEVBQU0sUUFBTjtZQUFlLFFBQUEsRUFBUyxDQUF4QjtTQUFMO1FBRVAsSUFBQyxDQUFBLEtBQUQsR0FBUyxRQUFRLENBQUM7UUFFbEIsSUFBQSxHQUFNLENBQUEsQ0FBRSxPQUFGO1FBRU4sSUFBSSxDQUFDLFdBQUwsQ0FBaUIsSUFBQyxDQUFBLEdBQWxCO1FBRUEsSUFBQyxDQUFBLE1BQUQsR0FBVSxJQUFJLFVBQUosQ0FBZSxJQUFDLENBQUEsR0FBaEI7UUFFVixJQUFJLENBQUMsRUFBTCxDQUFRLFlBQVIsRUFBcUIsSUFBQyxDQUFBLFlBQXRCO1FBRUEsSUFBQyxDQUFBLEdBQUcsQ0FBQyxnQkFBTCxDQUFzQixTQUF0QixFQUFnQyxJQUFDLENBQUEsS0FBakM7UUFDQSxJQUFDLENBQUEsR0FBRyxDQUFDLEtBQUwsQ0FBQTtRQUVBLElBQUMsQ0FBQSxNQUFNLENBQUMsY0FBUixDQUF1QixJQUF2QjtJQWpCRDs7cUJBeUJILEtBQUEsR0FBTyxTQUFDLEtBQUQ7QUFFSCxZQUFBO1FBQUEsT0FB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LENBQUMsSUFBTCxDQUFVLFlBQVY7QUFiN0MsaUJBY1MsUUFkVDtBQWNzQyx1QkFBTyxJQUFJLENBQUMsSUFBTCxDQUFVLFlBQVY7QUFkN0M7UUFnQkEsSUFBQSxDQUFLLDBCQUFBLEdBQTJCLElBQTNCLEdBQWdDLFNBQXJDLEVBQThDLElBQTlDO2VBQ0E7SUE1QlU7Ozs7OztBQThCbEIsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwMDAwMDAwICAwMDAwMDAwICAgIDAwMCAgMDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgXG4wMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICBcbjAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4wMDAwMDAwMCAgMDAwMDAwMCAgICAwMDAgICAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIFxuIyMjXG5cbnsgc2xhc2gsIGVtcHR5LCBwb3N0LCBvcGVuLCBlbGVtLCBzdG9wRXZlbnQsIGtleWluZm8sIGtsb2csICQsIF8gfSA9IHJlcXVpcmUgJ2t4aydcblxuRmlsZSAgICAgICA9IHJlcXVpcmUgJy4vdG9vbHMvZmlsZSdcbkJhc2VFZGl0b3IgPSByZXF1aXJlICcuL2VkaXRvci9lZGl0b3InXG5GaWxlRWRpdG9yID0gcmVxdWlyZSAnLi9lZGl0b3IvZmlsZWVkaXRvcidcblxuY2xhc3MgRWRpdG9yXG5cbiAgICBAOiAocGF0aCkgLT5cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgIEBkaXYgPSBlbGVtIGNsYXNzOidlZGl0b3InIHRhYmluZGV4OjFcbiAgICAgICAgXG4gICAgICAgIEBmb2N1cyA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRcbiAgICAgICAgXG4gICAgICAgIG1haW4gPSQgJyNtYWluJ1xuICAgICAgICAgICAgXG4gICAgICAgIG1haW4uYXBwZW5kQ2hpbGQgQGRpdlxuICAgICAgICBcbiAgICAgICAgQGVkaXRvciA9IG5ldyBGaWxlRWRpdG9yIEBkaXZcblxuICAgICAgICBwb3N0Lm9uICdtZW51QWN0aW9uJyBAb25NZW51QWN0aW9uXG4gICAgICAgIFxuICAgICAgICBAZGl2LmFkZEV2ZW50TGlzdGVuZXIgJ2tleWRvd24nIEBvbktleVxuICAgICAgICBAZGl2LmZvY3VzKClcbiAgICAgICAgXG4gICAgICAgIEBlZGl0b3Iuc2V0Q3VycmVudEZpbGUgcGF0aFxuICAgICAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAwMDAgICBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgICAgMDAwMDAgICAgXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgICAgICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgMDAwICAgICBcbiAgICBcbiAgICBvbktleTogKGV2ZW50KSA9PlxuXG4gICAgICAgIHsgbW9kLCBrZXksIGNvbWJvLCBjaGFyIH0gPSBrZXlpbmZvLmZvckV2ZW50IGV2ZW50XG5cbiAgICAgICAgc3dpdGNoIGNvbWJvXG4gICAgICAgICAgICB3aGVuICdjdHJsK3cnIHRoZW4gcmV0dXJuIHN0b3BFdmVudCBldmVudCwgQGNsb3NlKClcbiAgICAgICAgICAgIHdoZW4gJ2VzYycgICAgdGhlbiBpZiBub3QgQGVkaXRvci5kaXJ0eSB0aGVuIHJldHVybiBzdG9wRXZlbnQgZXZlbnQsIEBjbG9zZSgpXG4gICAgICAgICAgICB3aGVuICdzcGFjZScgXG4gICAgICAgICAgICAgICAgYyA9IEBlZGl0b3IubWFpbkN1cnNvcigpXG4gICAgICAgICAgICAgICAgaWYgY1swXSA9PSAxIGFuZCBjWzFdID09IDBcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0b3BFdmVudCBldmVudCwgQGNsb3NlKClcbiAgICAgICAga2xvZyAnb25LZXknIG1vZCwga2V5LCBjb21ib1xuICAgICAgICAgICAgXG4gICAgY2xvc2U6ID0+XG5cbiAgICAgICAgQGRpdi5yZW1vdmUoKVxuICAgICAgICBAZm9jdXMuZm9jdXMoKVxuICAgICAgICBAZWRpdG9yLmRlbCgpXG4gICAgICAgIGRlbGV0ZSBAZWRpdG9yXG4gICAgICAgIFxuICAgIHJlc2l6ZWQ6IC0+IEBlZGl0b3I/LnJlc2l6ZWQoKVxuICAgICAgICBcbiAgICAjIDAwICAgICAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMDAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDBcbiAgICAjIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMCAwIDAwMCAgMDAwICAgMDAwICAgICAwMDAwMDAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgMCAwMDBcbiAgICAjIDAwMCAwIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgICAwMDAgICAwMDAgICAwMDAwMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDBcblxuICAgIG9uTWVudUFjdGlvbjogKG5hbWUsIGFyZ3MpID0+XG5cbiAgICAgICAgcmV0dXJuIGlmIG5vdCBAZWRpdG9yXG4gICAgICAgIFxuICAgICAgICBrbG9nIFwiZWRpdG9yIG1lbnUgYWN0aW9uISAnI3tuYW1lfScgYXJnczpcIiBhcmdzXG4gICAgICAgIFxuICAgICAgICBpZiBhY3Rpb24gPSBCYXNlRWRpdG9yLmFjdGlvbldpdGhOYW1lIG5hbWVcbiAgICAgICAgICAgIGlmIGFjdGlvbi5rZXk/IGFuZCBfLmlzRnVuY3Rpb24gQGVkaXRvclthY3Rpb24ua2V5XVxuICAgICAgICAgICAgICAgIEBlZGl0b3JbYWN0aW9uLmtleV0gYXJncy5hY3RhcmdcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICBcbiAgICAgICAgc3dpdGNoIG5hbWVcbiAgICBcbiAgICAgICAgICAgIHdoZW4gJ0Nsb3NlIEVkaXRvcicgICAgICAgICAgdGhlbiByZXR1cm4gQGNsb3NlKClcbiAgICAgICAgICAgIHdoZW4gJ1VuZG8nICAgICAgICAgICAgICAgICAgdGhlbiByZXR1cm4gQGVkaXRvci5kby51bmRvKClcbiAgICAgICAgICAgIHdoZW4gJ1JlZG8nICAgICAgICAgICAgICAgICAgdGhlbiByZXR1cm4gQGVkaXRvci5kby5yZWRvKClcbiAgICAgICAgICAgIHdoZW4gJ0N1dCcgICAgICAgICAgICAgICAgICAgdGhlbiByZXR1cm4gQGVkaXRvci5jdXQoKVxuICAgICAgICAgICAgd2hlbiAnQ29weScgICAgICAgICAgICAgICAgICB0aGVuIHJldHVybiBAZWRpdG9yLmNvcHkoKVxuICAgICAgICAgICAgd2hlbiAnUGFzdGUnICAgICAgICAgICAgICAgICB0aGVuIHJldHVybiBAZWRpdG9yLnBhc3RlKClcbiAgICAgICAgICAgIHdoZW4gJ1RvZ2dsZSBDZW50ZXIgVGV4dCcgICAgdGhlbiByZXR1cm4gdG9nZ2xlQ2VudGVyVGV4dCgpXG4gICAgICAgICAgICB3aGVuICdJbmNyZWFzZScgICAgICAgICAgICAgIHRoZW4gcmV0dXJuIGNoYW5nZUZvbnRTaXplICsxXG4gICAgICAgICAgICB3aGVuICdEZWNyZWFzZScgICAgICAgICAgICAgIHRoZW4gcmV0dXJuIGNoYW5nZUZvbnRTaXplIC0xXG4gICAgICAgICAgICB3aGVuICdSZXNldCcgICAgICAgICAgICAgICAgIHRoZW4gcmV0dXJuIHJlc2V0Rm9udFNpemUoKVxuICAgICAgICAgICAgd2hlbiAnU2F2ZScgICAgICAgICAgICAgICAgICB0aGVuIHJldHVybiBwb3N0LmVtaXQgJ3NhdmVGaWxlJ1xuICAgICAgICAgICAgd2hlbiAnU2F2ZSBBcyAuLi4nICAgICAgICAgICB0aGVuIHJldHVybiBwb3N0LmVtaXQgJ3NhdmVGaWxlQXMnXG4gICAgICAgICAgICB3aGVuICdSZXZlcnQnICAgICAgICAgICAgICAgIHRoZW4gcmV0dXJuIHBvc3QuZW1pdCAncmVsb2FkRmlsZSdcbiAgICBcbiAgICAgICAga2xvZyBcInVuaGFuZGxlZCBtZW51IGFjdGlvbiEgJyN7bmFtZX0nIGFyZ3M6XCIgYXJnc1xuICAgICAgICAndW5oYW5kbGVkJ1xuICAgIFxubW9kdWxlLmV4cG9ydHMgPSBFZGl0b3JcbiJdfQ==
//# sourceURL=../coffee/editor.coffee
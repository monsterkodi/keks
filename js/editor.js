// koffee 1.4.0

/*
00000000  0000000    000  000000000   0000000   00000000   
000       000   000  000     000     000   000  000   000  
0000000   000   000  000     000     000   000  0000000    
000       000   000  000     000     000   000  000   000  
00000000  0000000    000     000      0000000   000   000
 */
var $, BaseEditor, Editor, File, FileEditor, Header, _, clamp, elem, empty, keyinfo, klog, open, post, prefs, ref, slash, stopEvent,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), slash = ref.slash, empty = ref.empty, clamp = ref.clamp, prefs = ref.prefs, post = ref.post, open = ref.open, elem = ref.elem, stopEvent = ref.stopEvent, keyinfo = ref.keyinfo, klog = ref.klog, $ = ref.$, _ = ref._;

File = require('./tools/file');

Header = require('./header');

BaseEditor = require('./editor/editor');

FileEditor = require('./editor/fileeditor');

Editor = (function() {
    function Editor(browser, path) {
        var main;
        this.browser = browser;
        this.onMenuAction = bind(this.onMenuAction, this);
        this.close = bind(this.close, this);
        this.onKey = bind(this.onKey, this);
        this.onDirty = bind(this.onDirty, this);
        this.div = elem({
            "class": 'editor',
            tabindex: 1
        });
        this.focus = document.activeElement;
        main = $('#main');
        main.appendChild(this.div);
        this.editor = new FileEditor(this.div);
        post.on('menuAction', this.onMenuAction);
        post.on('dirty', this.onDirty);
        this.div.addEventListener('keydown', this.onKey);
        this.div.focus();
        this.editor.setCurrentFile(path);
        if (prefs.get('centerText')) {
            this.editor.centerText(true, 0);
        }
        this.header = new Header(this.browser);
        this.header.setFile(path);
    }

    Editor.prototype.onDirty = function(dirty) {
        var ref1;
        return (ref1 = this.header) != null ? ref1.setDirty(dirty) : void 0;
    };

    Editor.prototype.onKey = function(event) {
        var c, char, combo, key, mod, ref1;
        ref1 = keyinfo.forEvent(event), mod = ref1.mod, key = ref1.key, combo = ref1.combo, char = ref1.char;
        switch (combo) {
            case 'ctrl+w':
                return stopEvent(event, this.close());
            case 'esc':
                if (!this.editor.dirty) {
                    return stopEvent(event, this.close());
                }
                break;
            case 'space':
                c = this.editor.mainCursor();
                if (c[0] === 1 && c[1] === 0) {
                    this.editor.setCursors([[0, 0]]);
                    return stopEvent(event, this.close());
                }
        }
    };

    Editor.prototype.close = function() {
        var ref1, ref2;
        if ((ref1 = this.editor) != null) {
            ref1.saveScrollCursorsAndSelections();
        }
        this.browser.viewer = null;
        this.header.del();
        this.div.remove();
        this.focus.focus();
        if ((ref2 = this.editor) != null) {
            ref2.del();
        }
        return delete this.editor;
    };

    Editor.prototype.resized = function() {
        var ref1;
        if ((ref1 = this.editor) != null) {
            ref1.resized();
        }
        if (prefs.get('centerText', false)) {
            return this.editor.centerText(true, 200);
        }
    };

    Editor.prototype.toggleCenterText = function() {
        var ref1, restoreInvisibles;
        klog('toggleCenterText');
        if (prefs.get("invisiblesâ–¸" + ((ref1 = this.editor.currentFile) != null ? ref1 : this.editor.name), false)) {
            this.editor.toggleInvisibles();
            restoreInvisibles = true;
        }
        if (!prefs.get('centerText', false)) {
            prefs.set('centerText', true);
            this.editor.centerText(true);
        } else {
            prefs.set('centerText', false);
            this.editor.centerText(false);
        }
        if (restoreInvisibles) {
            return this.editor.toggleInvisibles();
        }
    };

    Editor.prototype.setFontSize = function(s) {
        if (!_.isFinite(s)) {
            s = prefs.get('editorFontSize', 19);
        }
        s = clamp(8, 100, s);
        prefs.set('editorFontSize', s);
        this.editor.setFontSize(s);
        if (this.editor.currentFile != null) {
            return this.editor.setCurrentFile(this.editor.currentFile);
        }
    };

    Editor.prototype.changeFontSize = function(d) {
        var f;
        if (this.editor.size.fontSize >= 30) {
            f = 4;
        } else if (this.editor.size.fontSize >= 50) {
            f = 10;
        } else if (this.editor.size.fontSize >= 20) {
            f = 2;
        } else {
            f = 1;
        }
        return this.setFontSize(this.editor.size.fontSize + f * d);
    };

    Editor.prototype.resetFontSize = function() {
        var defaultFontSize;
        defaultFontSize = prefs.get('editorDefaultFontSize', 19);
        prefs.set('editorFontSize', defaultFontSize);
        return this.setFontSize(defaultFontSize);
    };

    Editor.prototype.onMenuAction = function(name, args) {
        var action;
        if (!this.editor) {
            return;
        }
        klog("editor menu action! '" + name + "' args:", args);
        if (action = BaseEditor.actionWithName(name)) {
            if ((action.key != null) && _.isFunction(this.editor[action.key])) {
                this.editor[action.key](args.actarg);
                return;
            }
        }
        switch (name) {
            case 'Close Editor':
                return this.close();
            case 'Undo':
                return this.editor["do"].undo();
            case 'Redo':
                return this.editor["do"].redo();
            case 'Cut':
                return this.editor.cut();
            case 'Copy':
                return this.editor.copy();
            case 'Paste':
                return this.editor.paste();
            case 'Toggle Center Text':
                return this.toggleCenterText();
            case 'Increase':
                return this.changeFontSize(+1);
            case 'Decrease':
                return this.changeFontSize(-1);
            case 'Reset':
                return this.resetFontSize();
            case 'Save':
                return this.editor.save();
            case 'Save As ...':
                return this.editor.saveAs();
            case 'Revert':
                return this.editor.revert();
        }
        klog("unhandled menu action! '" + name + "' args:", args);
        return 'unhandled';
    };

    return Editor;

})();

module.exports = Editor;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdG9yLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSwrSEFBQTtJQUFBOztBQVFBLE1BQW1GLE9BQUEsQ0FBUSxLQUFSLENBQW5GLEVBQUUsaUJBQUYsRUFBUyxpQkFBVCxFQUFnQixpQkFBaEIsRUFBdUIsaUJBQXZCLEVBQThCLGVBQTlCLEVBQW9DLGVBQXBDLEVBQTBDLGVBQTFDLEVBQWdELHlCQUFoRCxFQUEyRCxxQkFBM0QsRUFBb0UsZUFBcEUsRUFBMEUsU0FBMUUsRUFBNkU7O0FBRTdFLElBQUEsR0FBYSxPQUFBLENBQVEsY0FBUjs7QUFDYixNQUFBLEdBQWEsT0FBQSxDQUFRLFVBQVI7O0FBQ2IsVUFBQSxHQUFhLE9BQUEsQ0FBUSxpQkFBUjs7QUFDYixVQUFBLEdBQWEsT0FBQSxDQUFRLHFCQUFSOztBQUVQO0lBRUMsZ0JBQUMsT0FBRCxFQUFXLElBQVg7QUFFQyxZQUFBO1FBRkEsSUFBQyxDQUFBLFVBQUQ7Ozs7O1FBRUEsSUFBQyxDQUFBLEdBQUQsR0FBTyxJQUFBLENBQUs7WUFBQSxDQUFBLEtBQUEsQ0FBQSxFQUFNLFFBQU47WUFBZSxRQUFBLEVBQVMsQ0FBeEI7U0FBTDtRQUVQLElBQUMsQ0FBQSxLQUFELEdBQVMsUUFBUSxDQUFDO1FBRWxCLElBQUEsR0FBTSxDQUFBLENBQUUsT0FBRjtRQUVOLElBQUksQ0FBQyxXQUFMLENBQWlCLElBQUMsQ0FBQSxHQUFsQjtRQUVBLElBQUMsQ0FBQSxNQUFELEdBQVUsSUFBSSxVQUFKLENBQWUsSUFBQyxDQUFBLEdBQWhCO1FBRVYsSUFBSSxDQUFDLEVBQUwsQ0FBUSxZQUFSLEVBQXFCLElBQUMsQ0FBQSxZQUF0QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsT0FBUixFQUFnQixJQUFDLENBQUEsT0FBakI7UUFFQSxJQUFDLENBQUEsR0FBRyxDQUFDLGdCQUFMLENBQXNCLFNBQXRCLEVBQWdDLElBQUMsQ0FBQSxLQUFqQztRQUNBLElBQUMsQ0FBQSxHQUFHLENBQUMsS0FBTCxDQUFBO1FBRUEsSUFBQyxDQUFBLE1BQU0sQ0FBQyxjQUFSLENBQXVCLElBQXZCO1FBRUEsSUFBRyxLQUFLLENBQUMsR0FBTixDQUFVLFlBQVYsQ0FBSDtZQUNJLElBQUMsQ0FBQSxNQUFNLENBQUMsVUFBUixDQUFtQixJQUFuQixFQUF3QixDQUF4QixFQURKOztRQUdBLElBQUMsQ0FBQSxNQUFELEdBQVUsSUFBSSxNQUFKLENBQVcsSUFBQyxDQUFBLE9BQVo7UUFDVixJQUFDLENBQUEsTUFBTSxDQUFDLE9BQVIsQ0FBZ0IsSUFBaEI7SUF4QkQ7O3FCQTBCSCxPQUFBLEdBQVMsU0FBQyxLQUFEO0FBRUwsWUFBQTtrREFBTyxDQUFFLFFBQVQsQ0FBa0IsS0FBbEI7SUFGSzs7cUJBVVQsS0FBQSxHQUFPLFNBQUMsS0FBRDtBQUVILFlBQUE7UUFBQSxPQUE0QixPQUFPLENBQUMsUUFBUixDQUFpQixLQUFqQixDQUE1QixFQUFFLGNBQUYsRUFBTyxjQUFQLEVBQVksa0JBQVosRUFBbUI7QUFFbkIsZ0JBQU8sS0FBUDtBQUFBLGlCQUNTLFFBRFQ7QUFDdUIsdUJBQU8sU0FBQSxDQUFVLEtBQVYsRUFBaUIsSUFBQyxDQUFBLEtBQUQsQ0FBQSxDQUFqQjtBQUQ5QixpQkFFUyxLQUZUO2dCQUV1QixJQUFHLENBQUksSUFBQyxDQUFBLE1BQU0sQ0FBQyxLQUFmO0FBQTBCLDJCQUFPLFNBQUEsQ0FBVSxLQUFWLEVBQWlCLElBQUMsQ0FBQSxLQUFELENBQUEsQ0FBakIsRUFBakM7O0FBQWQ7QUFGVCxpQkFHUyxPQUhUO2dCQUlRLENBQUEsR0FBSSxJQUFDLENBQUEsTUFBTSxDQUFDLFVBQVIsQ0FBQTtnQkFDSixJQUFHLENBQUUsQ0FBQSxDQUFBLENBQUYsS0FBUSxDQUFSLElBQWMsQ0FBRSxDQUFBLENBQUEsQ0FBRixLQUFRLENBQXpCO29CQUNJLElBQUMsQ0FBQSxNQUFNLENBQUMsVUFBUixDQUFtQixDQUFDLENBQUMsQ0FBRCxFQUFHLENBQUgsQ0FBRCxDQUFuQjtBQUNBLDJCQUFPLFNBQUEsQ0FBVSxLQUFWLEVBQWlCLElBQUMsQ0FBQSxLQUFELENBQUEsQ0FBakIsRUFGWDs7QUFMUjtJQUpHOztxQkFhUCxLQUFBLEdBQU8sU0FBQTtBQUVILFlBQUE7O2dCQUFPLENBQUUsOEJBQVQsQ0FBQTs7UUFDQSxJQUFDLENBQUEsT0FBTyxDQUFDLE1BQVQsR0FBa0I7UUFDbEIsSUFBQyxDQUFBLE1BQU0sQ0FBQyxHQUFSLENBQUE7UUFDQSxJQUFDLENBQUEsR0FBRyxDQUFDLE1BQUwsQ0FBQTtRQUNBLElBQUMsQ0FBQSxLQUFLLENBQUMsS0FBUCxDQUFBOztnQkFDTyxDQUFFLEdBQVQsQ0FBQTs7ZUFDQSxPQUFPLElBQUMsQ0FBQTtJQVJMOztxQkFnQlAsT0FBQSxHQUFTLFNBQUE7QUFFTCxZQUFBOztnQkFBTyxDQUFFLE9BQVQsQ0FBQTs7UUFFQSxJQUFHLEtBQUssQ0FBQyxHQUFOLENBQVUsWUFBVixFQUF1QixLQUF2QixDQUFIO21CQUNJLElBQUMsQ0FBQSxNQUFNLENBQUMsVUFBUixDQUFtQixJQUFuQixFQUF3QixHQUF4QixFQURKOztJQUpLOztxQkFhVCxnQkFBQSxHQUFrQixTQUFBO0FBRWQsWUFBQTtRQUFBLElBQUEsQ0FBSyxrQkFBTDtRQUNBLElBQUcsS0FBSyxDQUFDLEdBQU4sQ0FBVSxhQUFBLEdBQWEsbURBQXVCLElBQUMsQ0FBQSxNQUFNLENBQUMsSUFBL0IsQ0FBdkIsRUFBOEQsS0FBOUQsQ0FBSDtZQUNJLElBQUMsQ0FBQSxNQUFNLENBQUMsZ0JBQVIsQ0FBQTtZQUNBLGlCQUFBLEdBQW9CLEtBRnhCOztRQUlBLElBQUcsQ0FBSSxLQUFLLENBQUMsR0FBTixDQUFVLFlBQVYsRUFBdUIsS0FBdkIsQ0FBUDtZQUNJLEtBQUssQ0FBQyxHQUFOLENBQVUsWUFBVixFQUF1QixJQUF2QjtZQUNBLElBQUMsQ0FBQSxNQUFNLENBQUMsVUFBUixDQUFtQixJQUFuQixFQUZKO1NBQUEsTUFBQTtZQUlJLEtBQUssQ0FBQyxHQUFOLENBQVUsWUFBVixFQUF1QixLQUF2QjtZQUNBLElBQUMsQ0FBQSxNQUFNLENBQUMsVUFBUixDQUFtQixLQUFuQixFQUxKOztRQU9BLElBQUcsaUJBQUg7bUJBQ0ksSUFBQyxDQUFBLE1BQU0sQ0FBQyxnQkFBUixDQUFBLEVBREo7O0lBZGM7O3FCQXVCbEIsV0FBQSxHQUFhLFNBQUMsQ0FBRDtRQUVULElBQXNDLENBQUksQ0FBQyxDQUFDLFFBQUYsQ0FBVyxDQUFYLENBQTFDO1lBQUEsQ0FBQSxHQUFJLEtBQUssQ0FBQyxHQUFOLENBQVUsZ0JBQVYsRUFBMkIsRUFBM0IsRUFBSjs7UUFDQSxDQUFBLEdBQUksS0FBQSxDQUFNLENBQU4sRUFBUyxHQUFULEVBQWMsQ0FBZDtRQUVKLEtBQUssQ0FBQyxHQUFOLENBQVUsZ0JBQVYsRUFBMkIsQ0FBM0I7UUFDQSxJQUFDLENBQUEsTUFBTSxDQUFDLFdBQVIsQ0FBb0IsQ0FBcEI7UUFDQSxJQUFHLCtCQUFIO21CQUNJLElBQUMsQ0FBQSxNQUFNLENBQUMsY0FBUixDQUF1QixJQUFDLENBQUEsTUFBTSxDQUFDLFdBQS9CLEVBREo7O0lBUFM7O3FCQVViLGNBQUEsR0FBZ0IsU0FBQyxDQUFEO0FBRVosWUFBQTtRQUFBLElBQVEsSUFBQyxDQUFBLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBYixJQUF5QixFQUFqQztZQUNJLENBQUEsR0FBSSxFQURSO1NBQUEsTUFFSyxJQUFHLElBQUMsQ0FBQSxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQWIsSUFBeUIsRUFBNUI7WUFDRCxDQUFBLEdBQUksR0FESDtTQUFBLE1BRUEsSUFBRyxJQUFDLENBQUEsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFiLElBQXlCLEVBQTVCO1lBQ0QsQ0FBQSxHQUFJLEVBREg7U0FBQSxNQUFBO1lBR0QsQ0FBQSxHQUFJLEVBSEg7O2VBSUwsSUFBQyxDQUFBLFdBQUQsQ0FBYSxJQUFDLENBQUEsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFiLEdBQXdCLENBQUEsR0FBRSxDQUF2QztJQVZZOztxQkFZaEIsYUFBQSxHQUFlLFNBQUE7QUFFWCxZQUFBO1FBQUEsZUFBQSxHQUFrQixLQUFLLENBQUMsR0FBTixDQUFVLHVCQUFWLEVBQWtDLEVBQWxDO1FBQ2xCLEtBQUssQ0FBQyxHQUFOLENBQVUsZ0JBQVYsRUFBMkIsZUFBM0I7ZUFDQSxJQUFDLENBQUEsV0FBRCxDQUFhLGVBQWI7SUFKVzs7cUJBWWYsWUFBQSxHQUFjLFNBQUMsSUFBRCxFQUFPLElBQVA7QUFFVixZQUFBO1FBQUEsSUFBVSxDQUFJLElBQUMsQ0FBQSxNQUFmO0FBQUEsbUJBQUE7O1FBRUEsSUFBQSxDQUFLLHVCQUFBLEdBQXdCLElBQXhCLEdBQTZCLFNBQWxDLEVBQTJDLElBQTNDO1FBRUEsSUFBRyxNQUFBLEdBQVMsVUFBVSxDQUFDLGNBQVgsQ0FBMEIsSUFBMUIsQ0FBWjtZQUNJLElBQUcsb0JBQUEsSUFBZ0IsQ0FBQyxDQUFDLFVBQUYsQ0FBYSxJQUFDLENBQUEsTUFBTyxDQUFBLE1BQU0sQ0FBQyxHQUFQLENBQXJCLENBQW5CO2dCQUNJLElBQUMsQ0FBQSxNQUFPLENBQUEsTUFBTSxDQUFDLEdBQVAsQ0FBUixDQUFvQixJQUFJLENBQUMsTUFBekI7QUFDQSx1QkFGSjthQURKOztBQUtBLGdCQUFPLElBQVA7QUFBQSxpQkFFUyxjQUZUO0FBRXNDLHVCQUFPLElBQUMsQ0FBQSxLQUFELENBQUE7QUFGN0MsaUJBR1MsTUFIVDtBQUdzQyx1QkFBTyxJQUFDLENBQUEsTUFBTSxFQUFDLEVBQUQsRUFBRyxDQUFDLElBQVgsQ0FBQTtBQUg3QyxpQkFJUyxNQUpUO0FBSXNDLHVCQUFPLElBQUMsQ0FBQSxNQUFNLEVBQUMsRUFBRCxFQUFHLENBQUMsSUFBWCxDQUFBO0FBSjdDLGlCQUtTLEtBTFQ7QUFLc0MsdUJBQU8sSUFBQyxDQUFBLE1BQU0sQ0FBQyxHQUFSLENBQUE7QUFMN0MsaUJBTVMsTUFOVDtBQU1zQyx1QkFBTyxJQUFDLENBQUEsTUFBTSxDQUFDLElBQVIsQ0FBQTtBQU43QyxpQkFPUyxPQVBUO0FBT3NDLHVCQUFPLElBQUMsQ0FBQSxNQUFNLENBQUMsS0FBUixDQUFBO0FBUDdDLGlCQVFTLG9CQVJUO0FBUXNDLHVCQUFPLElBQUMsQ0FBQSxnQkFBRCxDQUFBO0FBUjdDLGlCQVNTLFVBVFQ7QUFTc0MsdUJBQU8sSUFBQyxDQUFBLGNBQUQsQ0FBZ0IsQ0FBQyxDQUFqQjtBQVQ3QyxpQkFVUyxVQVZUO0FBVXNDLHVCQUFPLElBQUMsQ0FBQSxjQUFELENBQWdCLENBQUMsQ0FBakI7QUFWN0MsaUJBV1MsT0FYVDtBQVdzQyx1QkFBTyxJQUFDLENBQUEsYUFBRCxDQUFBO0FBWDdDLGlCQVlTLE1BWlQ7QUFZc0MsdUJBQU8sSUFBQyxDQUFBLE1BQU0sQ0FBQyxJQUFSLENBQUE7QUFaN0MsaUJBYVMsYUFiVDtBQWFzQyx1QkFBTyxJQUFDLENBQUEsTUFBTSxDQUFDLE1BQVIsQ0FBQTtBQWI3QyxpQkFjUyxRQWRUO0FBY3NDLHVCQUFPLElBQUMsQ0FBQSxNQUFNLENBQUMsTUFBUixDQUFBO0FBZDdDO1FBZ0JBLElBQUEsQ0FBSywwQkFBQSxHQUEyQixJQUEzQixHQUFnQyxTQUFyQyxFQUE4QyxJQUE5QztlQUNBO0lBNUJVOzs7Ozs7QUE4QmxCLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAwMDAwMCAgMDAwMDAwMCAgICAwMDAgIDAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIFxuMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbjAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgXG4wMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuMDAwMDAwMDAgIDAwMDAwMDAgICAgMDAwICAgICAwMDAgICAgICAwMDAwMDAwICAgMDAwICAgMDAwICBcbiMjI1xuXG57IHNsYXNoLCBlbXB0eSwgY2xhbXAsIHByZWZzLCBwb3N0LCBvcGVuLCBlbGVtLCBzdG9wRXZlbnQsIGtleWluZm8sIGtsb2csICQsIF8gfSA9IHJlcXVpcmUgJ2t4aydcblxuRmlsZSAgICAgICA9IHJlcXVpcmUgJy4vdG9vbHMvZmlsZSdcbkhlYWRlciAgICAgPSByZXF1aXJlICcuL2hlYWRlcidcbkJhc2VFZGl0b3IgPSByZXF1aXJlICcuL2VkaXRvci9lZGl0b3InXG5GaWxlRWRpdG9yID0gcmVxdWlyZSAnLi9lZGl0b3IvZmlsZWVkaXRvcidcblxuY2xhc3MgRWRpdG9yXG5cbiAgICBAOiAoQGJyb3dzZXIsIHBhdGgpIC0+XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICBAZGl2ID0gZWxlbSBjbGFzczonZWRpdG9yJyB0YWJpbmRleDoxXG4gICAgICAgIFxuICAgICAgICBAZm9jdXMgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50XG4gICAgICAgIFxuICAgICAgICBtYWluID0kICcjbWFpbidcbiAgICAgICAgICAgIFxuICAgICAgICBtYWluLmFwcGVuZENoaWxkIEBkaXZcbiAgICAgICAgXG4gICAgICAgIEBlZGl0b3IgPSBuZXcgRmlsZUVkaXRvciBAZGl2XG5cbiAgICAgICAgcG9zdC5vbiAnbWVudUFjdGlvbicgQG9uTWVudUFjdGlvblxuICAgICAgICBwb3N0Lm9uICdkaXJ0eScgQG9uRGlydHlcbiAgICAgICAgXG4gICAgICAgIEBkaXYuYWRkRXZlbnRMaXN0ZW5lciAna2V5ZG93bicgQG9uS2V5XG4gICAgICAgIEBkaXYuZm9jdXMoKVxuICAgICAgICBcbiAgICAgICAgQGVkaXRvci5zZXRDdXJyZW50RmlsZSBwYXRoXG4gICAgICAgIFxuICAgICAgICBpZiBwcmVmcy5nZXQgJ2NlbnRlclRleHQnXG4gICAgICAgICAgICBAZWRpdG9yLmNlbnRlclRleHQgdHJ1ZSAwXG4gICAgICAgIFxuICAgICAgICBAaGVhZGVyID0gbmV3IEhlYWRlciBAYnJvd3NlclxuICAgICAgICBAaGVhZGVyLnNldEZpbGUgcGF0aFxuICAgICAgICAgICAgXG4gICAgb25EaXJ0eTogKGRpcnR5KSA9PlxuICAgICAgICBcbiAgICAgICAgQGhlYWRlcj8uc2V0RGlydHkgZGlydHlcbiAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAwMDAgICBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgICAgMDAwMDAgICAgXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgICAgICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgMDAwICAgICBcbiAgICBcbiAgICBvbktleTogKGV2ZW50KSA9PlxuXG4gICAgICAgIHsgbW9kLCBrZXksIGNvbWJvLCBjaGFyIH0gPSBrZXlpbmZvLmZvckV2ZW50IGV2ZW50XG5cbiAgICAgICAgc3dpdGNoIGNvbWJvXG4gICAgICAgICAgICB3aGVuICdjdHJsK3cnIHRoZW4gcmV0dXJuIHN0b3BFdmVudCBldmVudCwgQGNsb3NlKClcbiAgICAgICAgICAgIHdoZW4gJ2VzYycgICAgdGhlbiBpZiBub3QgQGVkaXRvci5kaXJ0eSB0aGVuIHJldHVybiBzdG9wRXZlbnQgZXZlbnQsIEBjbG9zZSgpXG4gICAgICAgICAgICB3aGVuICdzcGFjZScgXG4gICAgICAgICAgICAgICAgYyA9IEBlZGl0b3IubWFpbkN1cnNvcigpXG4gICAgICAgICAgICAgICAgaWYgY1swXSA9PSAxIGFuZCBjWzFdID09IDBcbiAgICAgICAgICAgICAgICAgICAgQGVkaXRvci5zZXRDdXJzb3JzIFtbMCwwXV1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0b3BFdmVudCBldmVudCwgQGNsb3NlKClcbiAgICAgICAgICAgIFxuICAgIGNsb3NlOiA9PlxuXG4gICAgICAgIEBlZGl0b3I/LnNhdmVTY3JvbGxDdXJzb3JzQW5kU2VsZWN0aW9ucygpXG4gICAgICAgIEBicm93c2VyLnZpZXdlciA9IG51bGxcbiAgICAgICAgQGhlYWRlci5kZWwoKVxuICAgICAgICBAZGl2LnJlbW92ZSgpXG4gICAgICAgIEBmb2N1cy5mb2N1cygpXG4gICAgICAgIEBlZGl0b3I/LmRlbCgpXG4gICAgICAgIGRlbGV0ZSBAZWRpdG9yXG4gICAgICAgIFxuICAgICMgMDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgICAwMDAgICAwMDAgICAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAgMDAwICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgICAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwMDAwMCAgICBcbiAgICBcbiAgICByZXNpemVkOiAtPiBcbiAgICAgICAgXG4gICAgICAgIEBlZGl0b3I/LnJlc2l6ZWQoKVxuICAgICAgICBcbiAgICAgICAgaWYgcHJlZnMuZ2V0ICdjZW50ZXJUZXh0JyBmYWxzZVxuICAgICAgICAgICAgQGVkaXRvci5jZW50ZXJUZXh0IHRydWUgMjAwXG5cbiAgICAjICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgICAwMDAwICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgICAgIDAwMCAgICAgMDAwICAgICAgICAwMDAgMDAwICAgICAgMDAwXG4gICAgIyAwMDAgICAgICAgMDAwMDAwMCAgIDAwMCAwIDAwMCAgICAgMDAwICAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAgICAgICAgMDAwICAgICAwMDAwMDAwICAgICAwMDAwMCAgICAgICAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAwMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgICAgICAwMDAgICAgIDAwMCAgICAgICAgMDAwIDAwMCAgICAgIDAwMFxuICAgICMgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgICAgIDAwMCAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwXG4gICAgXG4gICAgdG9nZ2xlQ2VudGVyVGV4dDogLT5cbiAgICBcbiAgICAgICAga2xvZyAndG9nZ2xlQ2VudGVyVGV4dCdcbiAgICAgICAgaWYgcHJlZnMuZ2V0IFwiaW52aXNpYmxlc+KWuCN7QGVkaXRvci5jdXJyZW50RmlsZSA/IEBlZGl0b3IubmFtZX1cIiwgZmFsc2VcbiAgICAgICAgICAgIEBlZGl0b3IudG9nZ2xlSW52aXNpYmxlcygpXG4gICAgICAgICAgICByZXN0b3JlSW52aXNpYmxlcyA9IHRydWVcbiAgICBcbiAgICAgICAgaWYgbm90IHByZWZzLmdldCAnY2VudGVyVGV4dCcgZmFsc2VcbiAgICAgICAgICAgIHByZWZzLnNldCAnY2VudGVyVGV4dCcgdHJ1ZVxuICAgICAgICAgICAgQGVkaXRvci5jZW50ZXJUZXh0IHRydWVcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcHJlZnMuc2V0ICdjZW50ZXJUZXh0JyBmYWxzZVxuICAgICAgICAgICAgQGVkaXRvci5jZW50ZXJUZXh0IGZhbHNlXG4gICAgXG4gICAgICAgIGlmIHJlc3RvcmVJbnZpc2libGVzXG4gICAgICAgICAgICBAZWRpdG9yLnRvZ2dsZUludmlzaWJsZXMoKVxuICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAgICAgMDAwMDAwMCAgMDAwICAwMDAwMDAwICAwMDAwMDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAgICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgICAgIDAwMCAgIDAwMFxuICAgICMgMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAgICAwMDAgICAgICAgIDAwMDAwMDAgICAwMDAgICAgMDAwICAgIDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgICAgMDAwICAgICAgICAgICAgIDAwMCAgMDAwICAgMDAwICAgICAwMDBcbiAgICAjIDAwMCAgICAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAgICAwMDAwMDAwICAgMDAwICAwMDAwMDAwICAwMDAwMDAwMFxuICAgIFxuICAgIHNldEZvbnRTaXplOiAocykgLT5cbiAgICBcbiAgICAgICAgcyA9IHByZWZzLmdldCgnZWRpdG9yRm9udFNpemUnIDE5KSBpZiBub3QgXy5pc0Zpbml0ZSBzXG4gICAgICAgIHMgPSBjbGFtcCA4LCAxMDAsIHNcbiAgICBcbiAgICAgICAgcHJlZnMuc2V0ICdlZGl0b3JGb250U2l6ZScgc1xuICAgICAgICBAZWRpdG9yLnNldEZvbnRTaXplIHNcbiAgICAgICAgaWYgQGVkaXRvci5jdXJyZW50RmlsZT9cbiAgICAgICAgICAgIEBlZGl0b3Iuc2V0Q3VycmVudEZpbGUgQGVkaXRvci5jdXJyZW50RmlsZVxuICAgIFxuICAgIGNoYW5nZUZvbnRTaXplOiAoZCkgLT5cbiAgICBcbiAgICAgICAgaWYgICAgICBAZWRpdG9yLnNpemUuZm9udFNpemUgPj0gMzBcbiAgICAgICAgICAgIGYgPSA0XG4gICAgICAgIGVsc2UgaWYgQGVkaXRvci5zaXplLmZvbnRTaXplID49IDUwXG4gICAgICAgICAgICBmID0gMTBcbiAgICAgICAgZWxzZSBpZiBAZWRpdG9yLnNpemUuZm9udFNpemUgPj0gMjBcbiAgICAgICAgICAgIGYgPSAyXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGYgPSAxXG4gICAgICAgIEBzZXRGb250U2l6ZSBAZWRpdG9yLnNpemUuZm9udFNpemUgKyBmKmRcbiAgICBcbiAgICByZXNldEZvbnRTaXplOiAtPlxuICAgIFxuICAgICAgICBkZWZhdWx0Rm9udFNpemUgPSBwcmVmcy5nZXQgJ2VkaXRvckRlZmF1bHRGb250U2l6ZScgMTlcbiAgICAgICAgcHJlZnMuc2V0ICdlZGl0b3JGb250U2l6ZScgZGVmYXVsdEZvbnRTaXplXG4gICAgICAgIEBzZXRGb250U2l6ZSBkZWZhdWx0Rm9udFNpemVcbiAgICAgICAgICAgICAgICBcbiAgICAjIDAwICAgICAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMDAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDBcbiAgICAjIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMCAwIDAwMCAgMDAwICAgMDAwICAgICAwMDAwMDAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgMCAwMDBcbiAgICAjIDAwMCAwIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgICAwMDAgICAwMDAgICAwMDAwMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDBcblxuICAgIG9uTWVudUFjdGlvbjogKG5hbWUsIGFyZ3MpID0+XG5cbiAgICAgICAgcmV0dXJuIGlmIG5vdCBAZWRpdG9yXG4gICAgICAgIFxuICAgICAgICBrbG9nIFwiZWRpdG9yIG1lbnUgYWN0aW9uISAnI3tuYW1lfScgYXJnczpcIiBhcmdzXG4gICAgICAgIFxuICAgICAgICBpZiBhY3Rpb24gPSBCYXNlRWRpdG9yLmFjdGlvbldpdGhOYW1lIG5hbWVcbiAgICAgICAgICAgIGlmIGFjdGlvbi5rZXk/IGFuZCBfLmlzRnVuY3Rpb24gQGVkaXRvclthY3Rpb24ua2V5XVxuICAgICAgICAgICAgICAgIEBlZGl0b3JbYWN0aW9uLmtleV0gYXJncy5hY3RhcmdcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICBcbiAgICAgICAgc3dpdGNoIG5hbWVcbiAgICBcbiAgICAgICAgICAgIHdoZW4gJ0Nsb3NlIEVkaXRvcicgICAgICAgICAgdGhlbiByZXR1cm4gQGNsb3NlKClcbiAgICAgICAgICAgIHdoZW4gJ1VuZG8nICAgICAgICAgICAgICAgICAgdGhlbiByZXR1cm4gQGVkaXRvci5kby51bmRvKClcbiAgICAgICAgICAgIHdoZW4gJ1JlZG8nICAgICAgICAgICAgICAgICAgdGhlbiByZXR1cm4gQGVkaXRvci5kby5yZWRvKClcbiAgICAgICAgICAgIHdoZW4gJ0N1dCcgICAgICAgICAgICAgICAgICAgdGhlbiByZXR1cm4gQGVkaXRvci5jdXQoKVxuICAgICAgICAgICAgd2hlbiAnQ29weScgICAgICAgICAgICAgICAgICB0aGVuIHJldHVybiBAZWRpdG9yLmNvcHkoKVxuICAgICAgICAgICAgd2hlbiAnUGFzdGUnICAgICAgICAgICAgICAgICB0aGVuIHJldHVybiBAZWRpdG9yLnBhc3RlKClcbiAgICAgICAgICAgIHdoZW4gJ1RvZ2dsZSBDZW50ZXIgVGV4dCcgICAgdGhlbiByZXR1cm4gQHRvZ2dsZUNlbnRlclRleHQoKVxuICAgICAgICAgICAgd2hlbiAnSW5jcmVhc2UnICAgICAgICAgICAgICB0aGVuIHJldHVybiBAY2hhbmdlRm9udFNpemUgKzFcbiAgICAgICAgICAgIHdoZW4gJ0RlY3JlYXNlJyAgICAgICAgICAgICAgdGhlbiByZXR1cm4gQGNoYW5nZUZvbnRTaXplIC0xXG4gICAgICAgICAgICB3aGVuICdSZXNldCcgICAgICAgICAgICAgICAgIHRoZW4gcmV0dXJuIEByZXNldEZvbnRTaXplKClcbiAgICAgICAgICAgIHdoZW4gJ1NhdmUnICAgICAgICAgICAgICAgICAgdGhlbiByZXR1cm4gQGVkaXRvci5zYXZlKClcbiAgICAgICAgICAgIHdoZW4gJ1NhdmUgQXMgLi4uJyAgICAgICAgICAgdGhlbiByZXR1cm4gQGVkaXRvci5zYXZlQXMoKVxuICAgICAgICAgICAgd2hlbiAnUmV2ZXJ0JyAgICAgICAgICAgICAgICB0aGVuIHJldHVybiBAZWRpdG9yLnJldmVydCgpXG4gICAgXG4gICAgICAgIGtsb2cgXCJ1bmhhbmRsZWQgbWVudSBhY3Rpb24hICcje25hbWV9JyBhcmdzOlwiIGFyZ3NcbiAgICAgICAgJ3VuaGFuZGxlZCdcbiAgICBcbm1vZHVsZS5leHBvcnRzID0gRWRpdG9yXG4iXX0=
//# sourceURL=../coffee/editor.coffee
// koffee 1.4.0

/*
00000000  0000000    000  000000000   0000000   00000000   
000       000   000  000     000     000   000  000   000  
0000000   000   000  000     000     000   000  0000000    
000       000   000  000     000     000   000  000   000  
00000000  0000000    000     000      0000000   000   000
 */
var $, BaseEditor, Editor, File, FileEditor, Header, _, clamp, elem, empty, keyinfo, klog, open, post, prefs, ref, slash, stopEvent,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), slash = ref.slash, empty = ref.empty, clamp = ref.clamp, prefs = ref.prefs, post = ref.post, open = ref.open, elem = ref.elem, stopEvent = ref.stopEvent, keyinfo = ref.keyinfo, klog = ref.klog, $ = ref.$, _ = ref._;

File = require('./tools/file');

Header = require('./header');

BaseEditor = require('./editor/editor');

FileEditor = require('./editor/fileeditor');

Editor = (function() {
    function Editor(browser, path) {
        var main;
        this.browser = browser;
        this.onMenuAction = bind(this.onMenuAction, this);
        this.close = bind(this.close, this);
        this.onKey = bind(this.onKey, this);
        this.onDirty = bind(this.onDirty, this);
        this.div = elem({
            "class": 'editor',
            tabindex: 1
        });
        this.focus = document.activeElement;
        main = $('#main');
        main.appendChild(this.div);
        this.editor = new FileEditor(this.div);
        post.on('menuAction', this.onMenuAction);
        post.on('dirty', this.onDirty);
        this.div.addEventListener('keydown', this.onKey);
        this.div.focus();
        this.editor.setCurrentFile(path);
        if (prefs.get('centerText')) {
            this.editor.centerText(true, 0);
        }
        this.header = new Header(this.browser);
        this.header.setFile(path);
    }

    Editor.prototype.onDirty = function(dirty) {
        var ref1;
        return (ref1 = this.header) != null ? ref1.setDirty(dirty) : void 0;
    };

    Editor.prototype.onKey = function(event) {
        var c, char, combo, key, mod, ref1;
        ref1 = keyinfo.forEvent(event), mod = ref1.mod, key = ref1.key, combo = ref1.combo, char = ref1.char;
        switch (combo) {
            case 'ctrl+w':
                return stopEvent(event, this.close());
            case 'esc':
                if (!this.editor.dirty) {
                    return stopEvent(event, this.close());
                }
                break;
            case 'space':
                c = this.editor.mainCursor();
                if (c[0] === 1 && c[1] === 0) {
                    return stopEvent(event, this.close());
                }
        }
    };

    Editor.prototype.close = function() {
        var ref1;
        this.browser.viewer = null;
        this.header.del();
        this.div.remove();
        this.focus.focus();
        if ((ref1 = this.editor) != null) {
            ref1.del();
        }
        return delete this.editor;
    };

    Editor.prototype.resized = function() {
        var ref1;
        if ((ref1 = this.editor) != null) {
            ref1.resized();
        }
        if (prefs.get('centerText', false)) {
            return this.editor.centerText(true, 200);
        }
    };

    Editor.prototype.toggleCenterText = function() {
        var ref1, restoreInvisibles;
        klog('toggleCenterText');
        if (prefs.get("invisiblesâ–¸" + ((ref1 = this.editor.currentFile) != null ? ref1 : this.editor.name), false)) {
            this.editor.toggleInvisibles();
            restoreInvisibles = true;
        }
        if (!prefs.get('centerText', false)) {
            prefs.set('centerText', true);
            this.editor.centerText(true);
        } else {
            prefs.set('centerText', false);
            this.editor.centerText(false);
        }
        if (restoreInvisibles) {
            return this.editor.toggleInvisibles();
        }
    };

    Editor.prototype.setFontSize = function(s) {
        if (!_.isFinite(s)) {
            s = prefs.get('editorFontSize', 19);
        }
        s = clamp(8, 100, s);
        prefs.set('editorFontSize', s);
        this.editor.setFontSize(s);
        if (this.editor.currentFile != null) {
            return this.editor.setCurrentFile(this.editor.currentFile);
        }
    };

    Editor.prototype.changeFontSize = function(d) {
        var f;
        if (this.editor.size.fontSize >= 30) {
            f = 4;
        } else if (this.editor.size.fontSize >= 50) {
            f = 10;
        } else if (this.editor.size.fontSize >= 20) {
            f = 2;
        } else {
            f = 1;
        }
        return this.setFontSize(this.editor.size.fontSize + f * d);
    };

    Editor.prototype.resetFontSize = function() {
        var defaultFontSize;
        defaultFontSize = prefs.get('editorDefaultFontSize', 19);
        prefs.set('editorFontSize', defaultFontSize);
        return this.setFontSize(defaultFontSize);
    };

    Editor.prototype.onMenuAction = function(name, args) {
        var action;
        if (!this.editor) {
            return;
        }
        klog("editor menu action! '" + name + "' args:", args);
        if (action = BaseEditor.actionWithName(name)) {
            if ((action.key != null) && _.isFunction(this.editor[action.key])) {
                this.editor[action.key](args.actarg);
                return;
            }
        }
        switch (name) {
            case 'Close Editor':
                return this.close();
            case 'Undo':
                return this.editor["do"].undo();
            case 'Redo':
                return this.editor["do"].redo();
            case 'Cut':
                return this.editor.cut();
            case 'Copy':
                return this.editor.copy();
            case 'Paste':
                return this.editor.paste();
            case 'Toggle Center Text':
                return this.toggleCenterText();
            case 'Increase':
                return this.changeFontSize(+1);
            case 'Decrease':
                return this.changeFontSize(-1);
            case 'Reset':
                return this.resetFontSize();
            case 'Save':
                return this.editor.save();
            case 'Save As ...':
                return this.editor.saveAs();
            case 'Revert':
                return this.editor.revert();
        }
        klog("unhandled menu action! '" + name + "' args:", args);
        return 'unhandled';
    };

    return Editor;

})();

module.exports = Editor;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdG9yLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSwrSEFBQTtJQUFBOztBQVFBLE1BQW1GLE9BQUEsQ0FBUSxLQUFSLENBQW5GLEVBQUUsaUJBQUYsRUFBUyxpQkFBVCxFQUFnQixpQkFBaEIsRUFBdUIsaUJBQXZCLEVBQThCLGVBQTlCLEVBQW9DLGVBQXBDLEVBQTBDLGVBQTFDLEVBQWdELHlCQUFoRCxFQUEyRCxxQkFBM0QsRUFBb0UsZUFBcEUsRUFBMEUsU0FBMUUsRUFBNkU7O0FBRTdFLElBQUEsR0FBYSxPQUFBLENBQVEsY0FBUjs7QUFDYixNQUFBLEdBQWEsT0FBQSxDQUFRLFVBQVI7O0FBQ2IsVUFBQSxHQUFhLE9BQUEsQ0FBUSxpQkFBUjs7QUFDYixVQUFBLEdBQWEsT0FBQSxDQUFRLHFCQUFSOztBQUVQO0lBRUMsZ0JBQUMsT0FBRCxFQUFXLElBQVg7QUFFQyxZQUFBO1FBRkEsSUFBQyxDQUFBLFVBQUQ7Ozs7O1FBRUEsSUFBQyxDQUFBLEdBQUQsR0FBTyxJQUFBLENBQUs7WUFBQSxDQUFBLEtBQUEsQ0FBQSxFQUFNLFFBQU47WUFBZSxRQUFBLEVBQVMsQ0FBeEI7U0FBTDtRQUVQLElBQUMsQ0FBQSxLQUFELEdBQVMsUUFBUSxDQUFDO1FBRWxCLElBQUEsR0FBTSxDQUFBLENBQUUsT0FBRjtRQUVOLElBQUksQ0FBQyxXQUFMLENBQWlCLElBQUMsQ0FBQSxHQUFsQjtRQUVBLElBQUMsQ0FBQSxNQUFELEdBQVUsSUFBSSxVQUFKLENBQWUsSUFBQyxDQUFBLEdBQWhCO1FBRVYsSUFBSSxDQUFDLEVBQUwsQ0FBUSxZQUFSLEVBQXFCLElBQUMsQ0FBQSxZQUF0QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsT0FBUixFQUFnQixJQUFDLENBQUEsT0FBakI7UUFFQSxJQUFDLENBQUEsR0FBRyxDQUFDLGdCQUFMLENBQXNCLFNBQXRCLEVBQWdDLElBQUMs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Q0FBQSxjQUFELENBQWdCLENBQUMsQ0FBakI7QUFUN0MsaUJBVVMsVUFWVDtBQVVzQyx1QkFBTyxJQUFDLENBQUEsY0FBRCxDQUFnQixDQUFDLENBQWpCO0FBVjdDLGlCQVdTLE9BWFQ7QUFXc0MsdUJBQU8sSUFBQyxDQUFBLGFBQUQsQ0FBQTtBQVg3QyxpQkFZUyxNQVpUO0FBWXNDLHVCQUFPLElBQUMsQ0FBQSxNQUFNLENBQUMsSUFBUixDQUFBO0FBWjdDLGlCQWFTLGFBYlQ7QUFhc0MsdUJBQU8sSUFBQyxDQUFBLE1BQU0sQ0FBQyxNQUFSLENBQUE7QUFiN0MsaUJBY1MsUUFkVDtBQWNzQyx1QkFBTyxJQUFDLENBQUEsTUFBTSxDQUFDLE1BQVIsQ0FBQTtBQWQ3QztRQWdCQSxJQUFBLENBQUssMEJBQUEsR0FBMkIsSUFBM0IsR0FBZ0MsU0FBckMsRUFBOEMsSUFBOUM7ZUFDQTtJQTVCVTs7Ozs7O0FBOEJsQixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwMDAwMDAgIDAwMDAwMDAgICAgMDAwICAwMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICBcbjAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4wMDAwMDAwICAgMDAwICAgMDAwICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAwMDAwICAgIFxuMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbjAwMDAwMDAwICAwMDAwMDAwICAgIDAwMCAgICAgMDAwICAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgXG4jIyNcblxueyBzbGFzaCwgZW1wdHksIGNsYW1wLCBwcmVmcywgcG9zdCwgb3BlbiwgZWxlbSwgc3RvcEV2ZW50LCBrZXlpbmZvLCBrbG9nLCAkLCBfIH0gPSByZXF1aXJlICdreGsnXG5cbkZpbGUgICAgICAgPSByZXF1aXJlICcuL3Rvb2xzL2ZpbGUnXG5IZWFkZXIgICAgID0gcmVxdWlyZSAnLi9oZWFkZXInXG5CYXNlRWRpdG9yID0gcmVxdWlyZSAnLi9lZGl0b3IvZWRpdG9yJ1xuRmlsZUVkaXRvciA9IHJlcXVpcmUgJy4vZWRpdG9yL2ZpbGVlZGl0b3InXG5cbmNsYXNzIEVkaXRvclxuXG4gICAgQDogKEBicm93c2VyLCBwYXRoKSAtPlxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgQGRpdiA9IGVsZW0gY2xhc3M6J2VkaXRvcicgdGFiaW5kZXg6MVxuICAgICAgICBcbiAgICAgICAgQGZvY3VzID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudFxuICAgICAgICBcbiAgICAgICAgbWFpbiA9JCAnI21haW4nXG4gICAgICAgICAgICBcbiAgICAgICAgbWFpbi5hcHBlbmRDaGlsZCBAZGl2XG4gICAgICAgIFxuICAgICAgICBAZWRpdG9yID0gbmV3IEZpbGVFZGl0b3IgQGRpdlxuXG4gICAgICAgIHBvc3Qub24gJ21lbnVBY3Rpb24nIEBvbk1lbnVBY3Rpb25cbiAgICAgICAgcG9zdC5vbiAnZGlydHknIEBvbkRpcnR5XG4gICAgICAgIFxuICAgICAgICBAZGl2LmFkZEV2ZW50TGlzdGVuZXIgJ2tleWRvd24nIEBvbktleVxuICAgICAgICBAZGl2LmZvY3VzKClcbiAgICAgICAgXG4gICAgICAgIEBlZGl0b3Iuc2V0Q3VycmVudEZpbGUgcGF0aFxuICAgICAgICBcbiAgICAgICAgaWYgcHJlZnMuZ2V0ICdjZW50ZXJUZXh0J1xuICAgICAgICAgICAgQGVkaXRvci5jZW50ZXJUZXh0IHRydWUgMFxuICAgICAgICBcbiAgICAgICAgQGhlYWRlciA9IG5ldyBIZWFkZXIgQGJyb3dzZXJcbiAgICAgICAgQGhlYWRlci5zZXRGaWxlIHBhdGhcbiAgICAgICAgICAgIFxuICAgIG9uRGlydHk6IChkaXJ0eSkgPT5cbiAgICAgICAgXG4gICAgICAgIEBoZWFkZXI/LnNldERpcnR5IGRpcnR5XG4gICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgMDAwICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAgIDAwMDAwICAgIFxuICAgICMgMDAwICAwMDAgICAwMDAgICAgICAgICAgMDAwICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgb25LZXk6IChldmVudCkgPT5cblxuICAgICAgICB7IG1vZCwga2V5LCBjb21ibywgY2hhciB9ID0ga2V5aW5mby5mb3JFdmVudCBldmVudFxuXG4gICAgICAgIHN3aXRjaCBjb21ib1xuICAgICAgICAgICAgd2hlbiAnY3RybCt3JyB0aGVuIHJldHVybiBzdG9wRXZlbnQgZXZlbnQsIEBjbG9zZSgpXG4gICAgICAgICAgICB3aGVuICdlc2MnICAgIHRoZW4gaWYgbm90IEBlZGl0b3IuZGlydHkgdGhlbiByZXR1cm4gc3RvcEV2ZW50IGV2ZW50LCBAY2xvc2UoKVxuICAgICAgICAgICAgd2hlbiAnc3BhY2UnIFxuICAgICAgICAgICAgICAgIGMgPSBAZWRpdG9yLm1haW5DdXJzb3IoKVxuICAgICAgICAgICAgICAgIGlmIGNbMF0gPT0gMSBhbmQgY1sxXSA9PSAwXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdG9wRXZlbnQgZXZlbnQsIEBjbG9zZSgpXG4gICAgICAgICAgICBcbiAgICBjbG9zZTogPT5cblxuICAgICAgICBAYnJvd3Nlci52aWV3ZXIgPSBudWxsXG4gICAgICAgIEBoZWFkZXIuZGVsKClcbiAgICAgICAgQGRpdi5yZW1vdmUoKVxuICAgICAgICBAZm9jdXMuZm9jdXMoKVxuICAgICAgICBAZWRpdG9yPy5kZWwoKVxuICAgICAgICBkZWxldGUgQGVkaXRvclxuICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgICAgMDAwICAgMDAwICAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgIDAwMCAgICAwMDAwMDAwICAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgcmVzaXplZDogLT4gXG4gICAgICAgIFxuICAgICAgICBAZWRpdG9yPy5yZXNpemVkKClcbiAgICAgICAgXG4gICAgICAgIGlmIHByZWZzLmdldCAnY2VudGVyVGV4dCcgZmFsc2VcbiAgICAgICAgICAgIEBlZGl0b3IuY2VudGVyVGV4dCB0cnVlIDIwMFxuXG4gICAgIyAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwMCAgMDAwMDAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAgICAgICAgMDAwMCAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgICAgICAwMDAgICAgIDAwMCAgICAgICAgMDAwIDAwMCAgICAgIDAwMFxuICAgICMgMDAwICAgICAgIDAwMDAwMDAgICAwMDAgMCAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgICAgICAgIDAwMCAgICAgMDAwMDAwMCAgICAgMDAwMDAgICAgICAgMDAwXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgMDAwICAgMDAwICAgICAgICAgMDAwICAgICAwMDAgICAgICAgIDAwMCAwMDAgICAgICAwMDBcbiAgICAjICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAgICAgICAwMDAgICAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAgIDAwMFxuICAgIFxuICAgIHRvZ2dsZUNlbnRlclRleHQ6IC0+XG4gICAgXG4gICAgICAgIGtsb2cgJ3RvZ2dsZUNlbnRlclRleHQnXG4gICAgICAgIGlmIHByZWZzLmdldCBcImludmlzaWJsZXPilrgje0BlZGl0b3IuY3VycmVudEZpbGUgPyBAZWRpdG9yLm5hbWV9XCIsIGZhbHNlXG4gICAgICAgICAgICBAZWRpdG9yLnRvZ2dsZUludmlzaWJsZXMoKVxuICAgICAgICAgICAgcmVzdG9yZUludmlzaWJsZXMgPSB0cnVlXG4gICAgXG4gICAgICAgIGlmIG5vdCBwcmVmcy5nZXQgJ2NlbnRlclRleHQnIGZhbHNlXG4gICAgICAgICAgICBwcmVmcy5zZXQgJ2NlbnRlclRleHQnIHRydWVcbiAgICAgICAgICAgIEBlZGl0b3IuY2VudGVyVGV4dCB0cnVlXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHByZWZzLnNldCAnY2VudGVyVGV4dCcgZmFsc2VcbiAgICAgICAgICAgIEBlZGl0b3IuY2VudGVyVGV4dCBmYWxzZVxuICAgIFxuICAgICAgICBpZiByZXN0b3JlSW52aXNpYmxlc1xuICAgICAgICAgICAgQGVkaXRvci50b2dnbGVJbnZpc2libGVzKClcbiAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgICAgIDAwMDAwMDAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgICAgMDAwICAgICAgICAwMDAgICAgICAgMDAwICAgICAwMDAgICAwMDBcbiAgICAjIDAwMDAwMCAgICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgICAgMDAwICAgICAgICAwMDAwMDAwICAgMDAwICAgIDAwMCAgICAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgIDAwMDAgICAgIDAwMCAgICAgICAgICAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwXG4gICAgIyAwMDAgICAgICAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgICAgMDAwMDAwMCAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDBcbiAgICBcbiAgICBzZXRGb250U2l6ZTogKHMpIC0+XG4gICAgXG4gICAgICAgIHMgPSBwcmVmcy5nZXQoJ2VkaXRvckZvbnRTaXplJyAxOSkgaWYgbm90IF8uaXNGaW5pdGUgc1xuICAgICAgICBzID0gY2xhbXAgOCwgMTAwLCBzXG4gICAgXG4gICAgICAgIHByZWZzLnNldCAnZWRpdG9yRm9udFNpemUnIHNcbiAgICAgICAgQGVkaXRvci5zZXRGb250U2l6ZSBzXG4gICAgICAgIGlmIEBlZGl0b3IuY3VycmVudEZpbGU/XG4gICAgICAgICAgICBAZWRpdG9yLnNldEN1cnJlbnRGaWxlIEBlZGl0b3IuY3VycmVudEZpbGVcbiAgICBcbiAgICBjaGFuZ2VGb250U2l6ZTogKGQpIC0+XG4gICAgXG4gICAgICAgIGlmICAgICAgQGVkaXRvci5zaXplLmZvbnRTaXplID49IDMwXG4gICAgICAgICAgICBmID0gNFxuICAgICAgICBlbHNlIGlmIEBlZGl0b3Iuc2l6ZS5mb250U2l6ZSA+PSA1MFxuICAgICAgICAgICAgZiA9IDEwXG4gICAgICAgIGVsc2UgaWYgQGVkaXRvci5zaXplLmZvbnRTaXplID49IDIwXG4gICAgICAgICAgICBmID0gMlxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBmID0gMVxuICAgICAgICBAc2V0Rm9udFNpemUgQGVkaXRvci5zaXplLmZvbnRTaXplICsgZipkXG4gICAgXG4gICAgcmVzZXRGb250U2l6ZTogLT5cbiAgICBcbiAgICAgICAgZGVmYXVsdEZvbnRTaXplID0gcHJlZnMuZ2V0ICdlZGl0b3JEZWZhdWx0Rm9udFNpemUnIDE5XG4gICAgICAgIHByZWZzLnNldCAnZWRpdG9yRm9udFNpemUnIGRlZmF1bHRGb250U2l6ZVxuICAgICAgICBAc2V0Rm9udFNpemUgZGVmYXVsdEZvbnRTaXplXG4gICAgICAgICAgICAgICAgXG4gICAgIyAwMCAgICAgMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAwICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwXG4gICAgIyAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgICAgMDAwMDAwMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwXG4gICAgIyAwMDAgMCAwMDAgIDAwMCAgICAgICAwMDAgIDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgICAgMDAwICAgMDAwICAgMDAwMDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG5cbiAgICBvbk1lbnVBY3Rpb246IChuYW1lLCBhcmdzKSA9PlxuXG4gICAgICAgIHJldHVybiBpZiBub3QgQGVkaXRvclxuICAgICAgICBcbiAgICAgICAga2xvZyBcImVkaXRvciBtZW51IGFjdGlvbiEgJyN7bmFtZX0nIGFyZ3M6XCIgYXJnc1xuICAgICAgICBcbiAgICAgICAgaWYgYWN0aW9uID0gQmFzZUVkaXRvci5hY3Rpb25XaXRoTmFtZSBuYW1lXG4gICAgICAgICAgICBpZiBhY3Rpb24ua2V5PyBhbmQgXy5pc0Z1bmN0aW9uIEBlZGl0b3JbYWN0aW9uLmtleV1cbiAgICAgICAgICAgICAgICBAZWRpdG9yW2FjdGlvbi5rZXldIGFyZ3MuYWN0YXJnXG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgXG4gICAgICAgIHN3aXRjaCBuYW1lXG4gICAgXG4gICAgICAgICAgICB3aGVuICdDbG9zZSBFZGl0b3InICAgICAgICAgIHRoZW4gcmV0dXJuIEBjbG9zZSgpXG4gICAgICAgICAgICB3aGVuICdVbmRvJyAgICAgICAgICAgICAgICAgIHRoZW4gcmV0dXJuIEBlZGl0b3IuZG8udW5kbygpXG4gICAgICAgICAgICB3aGVuICdSZWRvJyAgICAgICAgICAgICAgICAgIHRoZW4gcmV0dXJuIEBlZGl0b3IuZG8ucmVkbygpXG4gICAgICAgICAgICB3aGVuICdDdXQnICAgICAgICAgICAgICAgICAgIHRoZW4gcmV0dXJuIEBlZGl0b3IuY3V0KClcbiAgICAgICAgICAgIHdoZW4gJ0NvcHknICAgICAgICAgICAgICAgICAgdGhlbiByZXR1cm4gQGVkaXRvci5jb3B5KClcbiAgICAgICAgICAgIHdoZW4gJ1Bhc3RlJyAgICAgICAgICAgICAgICAgdGhlbiByZXR1cm4gQGVkaXRvci5wYXN0ZSgpXG4gICAgICAgICAgICB3aGVuICdUb2dnbGUgQ2VudGVyIFRleHQnICAgIHRoZW4gcmV0dXJuIEB0b2dnbGVDZW50ZXJUZXh0KClcbiAgICAgICAgICAgIHdoZW4gJ0luY3JlYXNlJyAgICAgICAgICAgICAgdGhlbiByZXR1cm4gQGNoYW5nZUZvbnRTaXplICsxXG4gICAgICAgICAgICB3aGVuICdEZWNyZWFzZScgICAgICAgICAgICAgIHRoZW4gcmV0dXJuIEBjaGFuZ2VGb250U2l6ZSAtMVxuICAgICAgICAgICAgd2hlbiAnUmVzZXQnICAgICAgICAgICAgICAgICB0aGVuIHJldHVybiBAcmVzZXRGb250U2l6ZSgpXG4gICAgICAgICAgICB3aGVuICdTYXZlJyAgICAgICAgICAgICAgICAgIHRoZW4gcmV0dXJuIEBlZGl0b3Iuc2F2ZSgpXG4gICAgICAgICAgICB3aGVuICdTYXZlIEFzIC4uLicgICAgICAgICAgIHRoZW4gcmV0dXJuIEBlZGl0b3Iuc2F2ZUFzKClcbiAgICAgICAgICAgIHdoZW4gJ1JldmVydCcgICAgICAgICAgICAgICAgdGhlbiByZXR1cm4gQGVkaXRvci5yZXZlcnQoKVxuICAgIFxuICAgICAgICBrbG9nIFwidW5oYW5kbGVkIG1lbnUgYWN0aW9uISAnI3tuYW1lfScgYXJnczpcIiBhcmdzXG4gICAgICAgICd1bmhhbmRsZWQnXG4gICAgXG5tb2R1bGUuZXhwb3J0cyA9IEVkaXRvclxuIl19
//# sourceURL=../coffee/editor.coffee